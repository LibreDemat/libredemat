<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:task="http://www.springframework.org/schema/task"
     xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd">

  <aop:aspectj-autoproxy/>

  <task:annotation-driven/>

  <bean id="loggingAspect" class="org.libredemat.util.development.LoggingAspect" />
  <bean id="contextAspect" class="org.libredemat.security.aspect.ContextAspect" />
  <bean id="hibernateExceptionTranslatorAspect" 
    class="org.libredemat.dao.hibernate.HibernateExceptionTranslatorAspect" />
  <bean id="requestCompositionEnforcingAspect"
    class="org.libredemat.dao.request.RequestCompositionEnforcingAspect" />

  <!-- ======================================================= -->
  <!-- ========== GENERAL SERVICES DEFINITION ================ -->  
  <!-- ======================================================= -->
 
  <bean id="log" class="org.libredemat.util.logging.impl.Log">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
  </bean>

  <bean id="authenticationService" 
    class="org.libredemat.authentication.impl.AuthenticationService">
    <property name="adultDAO" ref="adultDAO"/>
    <property name="individualDAO" ref="individualDAO" />
    <property name="agentDAO" ref="agentDAO"/>
    <property name="defaultAuthenticationMethod" value="${authentication.method}" />
  </bean>

  <bean id="oauth2Service" class="org.libredemat.oauth2.impl.OAuth2Service">
    <property name="agentDAO" ref="agentDAO"/>
    <property name="adultDAO" ref="adultDAO"/>
  </bean>

  <bean id="mailService" class="org.libredemat.util.mail.impl.MailService">
    <property name="mailSender">
      <ref bean="mailSender"/>
    </property>
    <property name="systemEmail" value="${mail.admin_address}"/> 
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
  </bean>

  <bean id="smsService" class="org.libredemat.util.sms.impl.SmsService">
  </bean>

  <bean id="fakeSmsService" class="org.libredemat.util.sms.impl.FakeSmsService" />
  
  <bean id="requestPdfService" class="org.libredemat.service.request.impl.RequestPdfService">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry"/>
    <property name="translationService" ref="translationService"/>
    <property name="userSearchService" ref="userSearchService"/>
    <property name="localReferentialService" ref="localReferentialService"/>
    <property name="requestSearchService" ref="requestSearchService"/>
    <property name="agentService" ref="agentService"/>
    <property name="requestExternalActionService" ref="requestExternalActionService"/>
    <property name="documentService" ref="documentService"/>
  </bean>

  <bean id="securityContext" class="org.libredemat.security.SecurityContext">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="agentService" ref="agentService" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="administratorGroups" value="${agent.administrator_group}" />
    <property name="agentGroups" value="${agent.contributor_group}" />
  </bean>
  
  <bean id="externalService" class="org.libredemat.external.impl.ExternalService" />

  <!-- *******************************************************************  -->
  <!-- ******************** AUTHORITY SERVICES ***************************  -->
  <!-- *******************************************************************  -->

  <bean id="localAuthoritiesLoader"
    class="org.libredemat.service.authority.LocalAuthoritiesLoader"
    init-method="init" depends-on="securityContext">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry"/>
  </bean>

  <bean id="agentService" class="org.libredemat.service.authority.impl.AgentService">
    <property name="agentDAO" ref="agentDAO"/>
    <property name="authenticationService">
      <ref bean="authenticationService"/>
    </property>
    <property name="translationService" ref="translationService" />
    <property name="mailService" ref="mailService" />
  </bean>

  <bean id="agentServiceToUserUtilsInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.util.UserUtils.setAgentService" />
    <property name="arguments">
      <list>
        <ref local="agentService" />
      </list>
    </property>
  </bean>

  <bean id="schoolService" class="org.libredemat.service.authority.impl.SchoolService">
    <property name="DAO" ref="schoolDAO"/>
  </bean>

  <bean id="recreationCenterService" 
    class="org.libredemat.service.authority.impl.RecreationCenterService">
    <property name="DAO" ref="recreationCenterDAO"/>
  </bean>

  <!-- ******************** REQUEST SERVICES **********************  -->
  
  <bean id="requestContextCheckAspect" 
    class="org.libredemat.service.request.aspect.RequestContextCheckAspect">
    <property name="requestDAO" ref="requestDAO" />  
    <property name="requestTypeDAO" ref="requestTypeDAO" />
    <property name="categoryDAO" ref="categoryDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="individualDAO" ref="individualDAO" />
  </bean>

  <bean id="requestFilterAspect"
    class="org.libredemat.service.request.aspect.RequestFilterAspect">
    <property name="categoryService" ref="categoryService" />
  </bean>

  <bean id="localReferentialService"
    class="org.libredemat.service.request.impl.LocalReferentialService">
    <property name="localReferentialDAO" ref="localReferentialDAO" />
  </bean>
  <bean id="localReferentialServiceToLocalReferentialCheckInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.service.request.LocalReferentialCheck.setLocalReferentialService" />
    <property name="arguments">
      <list>
        <ref local="localReferentialService" />
      </list>
    </property>
  </bean>
  
  <bean id="categoryService" class="org.libredemat.service.request.impl.CategoryService">
    <property name="categoryDAO" ref="categoryDAO"/>
    <property name="requestTypeDAO" ref="requestTypeDAO"/>
    <property name="agentService" ref="agentService" />
    <property name="requestServiceRegistry" ref="requestServiceRegistry" />
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
  </bean>

  <bean id="requestService" class="org.libredemat.service.request.impl.RequestService"
    abstract="true" init-method="init">
    <property name="genericDAO" ref="genericDAO" />
    <property name="requestTypeService" ref="requestTypeService" />
    <property name="filingDelay" value="6"/>
    <property name="archiveDocuments" value="false"/>
  </bean>
  
  <bean id="requestServiceRegistry" class="org.libredemat.service.request.impl.RequestServiceRegistry">
    <property name="requestDAO" ref="requestDAO"/>
  </bean>

  <bean id="requestServiceRegistryToSubjectIdCheckInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.service.request.SubjectIdCheck.setRequestServiceRegistry" />
    <property name="arguments">
      <list>
        <ref local="requestServiceRegistry" />
      </list>
    </property>
  </bean>

  <bean id="requestWorkflowService" class="org.libredemat.service.request.impl.RequestWorkflowService">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="requestDAO" ref="requestDAO" />
    <property name="requestActionService" ref="requestActionService" />
    <property name="requestServiceRegistry" ref="requestServiceRegistry" />
    <property name="requestExternalService" ref="requestExternalService" />
    <property name="documentService" ref="documentService" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="requestDocumentService" ref="requestDocumentService" />
    <property name="requestTypeService" ref="requestTypeService" />
    <property name="requestPdfService" ref="requestPdfService" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="userWorkflowService" ref="userWorkflowService" />
    <property name="paymentService" ref="paymentService" />
  </bean>

  <bean id="requestWorkflowServiceToSubjectIdCheckInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.service.request.SubjectIdCheck.setRequestWorkflowService" />
    <property name="arguments">
      <list>
        <ref local="requestWorkflowService" />
      </list>
    </property>
  </bean>

  <bean id="autofillService" class="org.libredemat.service.request.impl.AutofillService">
    <property name="userSearchService" ref="userSearchService"/>
  </bean>

  <bean id="conditionService" class="org.libredemat.service.request.impl.ConditionService">
    <property name="requestServiceRegistry" ref="requestServiceRegistry"/>
  </bean>

  <bean id="requestTypeService" class="org.libredemat.service.request.impl.RequestTypeService"
    init-method="init">
    <property name="genericDAO" ref="genericDAO"/>
    <property name="requestTypeDAO" ref="requestTypeDAO"/>
    <property name="requestFormDAO" ref="requestFormDAO"/>
    <property name="requestServiceRegistry" ref="requestServiceRegistry" />
    <property name="documentTypeService" ref="documentTypeService" />
    <property name="categoryService" ref="categoryService" />
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="authenticationService" ref="authenticationService" />
  </bean>

  <bean id="requestActionService" class="org.libredemat.service.request.impl.RequestActionService">
    <property name="requestDAO" ref="requestDAO"/>
    <property name="requestActionDAO" ref="requestActionDAO"/>
  </bean>

  <bean id="requestNotificationService"
    class="org.libredemat.service.request.impl.RequestNotificationService">
    <property name="requestDAO" ref="requestDAO" />
    <property name="mailService" ref="mailService" />
    <property name="userSearchService" ref="userSearchService"/>
    <property name="localAuthorityRegistry"><ref bean="localAuthorityRegistry"/></property>
    <property name="translationService" ref="translationService"/>
    <property name="agentService" ref="agentService" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="requestTypeService" ref="requestTypeService" />
  </bean>

  <bean id="requestStatisticsService" class="org.libredemat.service.request.impl.RequestStatisticsService">
    <property name="requestStatisticsDAO" ref="requestStatisticsDAO"/>
    <property name="categoryService" ref="categoryService" />
    <property name="requestWorkflowService" ref="requestWorkflowService" />
    <property name="requestTypeService" ref="requestTypeService" />
  </bean>

  <bean id="requestExternalService" class="org.libredemat.service.request.external.impl.RequestExternalService"
    parent="externalService">
    <property name="requestDAO" ref="requestDAO" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
    <property name="requestExportService" ref="requestExportService" />
    <property name="translationService" ref="translationService" />
    <property name="mailService" ref="mailService" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="requestExternalActionService" ref="requestExternalActionService" />
    <property name="requestTypeService" ref="requestTypeService" />
  </bean>

  <bean id="requestExternalActionService" class="org.libredemat.service.request.external.impl.RequestExternalActionService">
    <property name="requestExternalActionDAO" ref="requestExternalActionDAO" />
  </bean>

  <bean id="requestExportService" class="org.libredemat.service.request.impl.RequestExportService">
    <property name="userSearchService" ref="userSearchService" />
  </bean>
  
  <bean id="requestSearchService" class="org.libredemat.service.request.impl.RequestSearchService">
    <property name="requestDAO" ref="requestDAO" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
  </bean>

  <bean id="requestDocumentService" class="org.libredemat.service.request.impl.RequestDocumentService">
    <property name="documentService" ref="documentService" />
    <property name="requestExternalService" ref="requestExternalService" />
    <property name="requestExternalActionService" ref="requestExternalActionService" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="requestTypeService" ref="requestTypeService" />
    <property name="translationService" ref="translationService" />
    <property name="documentTypeService" ref="documentTypeService" />
    <property name="requestDAO" ref="requestDAO" />
  </bean>
  
  <bean id="requestLockService" class="org.libredemat.service.request.impl.RequestLockService">
    <property name="requestDAO" ref="requestDAO" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="requestTypeService" ref="requestTypeService" />
  </bean>
  
  <bean id="requestNoteService" class="org.libredemat.service.request.impl.RequestNoteService">
    <property name="requestDAO" ref="requestDAO" />
    <property name="requestNoteDAO" ref="requestNoteDAO" />
    <property name="agentService" ref="agentService" />
  </bean>
  
  <bean id="requestPaymentsListener" class="org.libredemat.service.request.impl.RequestPaymentsListener">
    <property name="requestDAO" ref="requestDAO" />
    <property name="requestServiceRegistry" ref="requestServiceRegistry" />
    <property name="requestWorkflowService" ref="requestWorkflowService" />
  </bean>

   <bean id="ticketBookingService" class="org.libredemat.service.request.impl.TicketBookingService">
    <property name="ticketBookingDAO" ref="ticketBookingDAO" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="localReferentialService" ref="localReferentialService" />
  </bean>

  <bean id="parkCardService" class="org.libredemat.service.request.impl.ParkCardService">
      <property name="parkCardDAO" ref="parkCardDAO" />
  </bean>

  <!-- *************************************************************************  -->
  <!-- ************************ DOCUMENTS RELATED SERVICES *********************  -->
  <!-- *************************************************************************  -->

  <bean id="documentContextCheckAspect" 
    class="org.libredemat.service.document.aspect.DocumentContextCheckAspect">
    <property name="documentDAO" ref="documentDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="individualDAO" ref="individualDAO" />
  </bean>

  <bean id="documentService" class="org.libredemat.service.document.impl.DocumentService">
    <property name="documentDAO" ref="documentDAO"/>
    <property name="documentTypeDAO" ref="documentTypeDAO"/>
    <property name="userSearchService" ref="userSearchService"/>
    <property name="genericDAO" ref="genericDAO" />
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry"/>
    <property name="translationService" ref="translationService"/>
    <property name="maxDataSize" value="${document.upload.maxSize}" />
  </bean>

  <bean id="documentTypeService" class="org.libredemat.service.document.impl.DocumentTypeService">
    <property name="documentTypeDAO" ref="documentTypeDAO"/>
    <property name="documentBootstrapper">
      <bean class="org.libredemat.service.document.impl.DocumentBootstrapper">
        <property name="documentTypeDAO" ref="documentTypeDAO" />
      </bean>
    </property>
  </bean>

  <bean id="ZDBInitializer" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod" value="zdb.ZDB.readConfiguration" />
  </bean>

  <!-- *******************************************************************  -->
  <!-- *********************** USERS SERVICES*****************************  -->
  <!-- *******************************************************************  -->

  <bean id="usersContextCheckAspect" 
    class="org.libredemat.service.users.aspect.UsersContextAspect">
    <property name="homeFolderDAO" ref="homeFolderDAO"/>
    <property name="individualDAO" ref="individualDAO"/>
    <property name="genericDAO" ref="genericDAO" />
  </bean>

  <bean id="userSecurityService" class="org.libredemat.service.users.impl.UserSecurityService">
    <property name="genericDAO" ref="genericDAO" />
    <property name="agentService" ref="agentService" />
  </bean>

  <bean id="userService" class="org.libredemat.service.users.impl.UserService">
    <property name="userSearchService" ref="userSearchService" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="adultDAO" ref="adultDAO" />
  </bean>

  <bean id="userNotificationService" class="org.libredemat.service.users.impl.UserNotificationService">
    <property name="userSearchService" ref="userSearchService"/>
    <property name="meansOfContactService" ref="meansOfContactService"/>
    <property name="mailService" ref="mailService"/>
    <property name="smsService" ref="smsService"/>
    <property name="translationService" ref="translationService"/>
    <property name="homeFolderDAO" ref="homeFolderDAO"/>
    <property name="userService" ref="userService" />
    <property name="genericDAO" ref="genericDAO" />
  </bean>

  <bean id="userWorkflowService" class="org.libredemat.service.users.impl.UserWorkflowService">
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="authenticationService" ref="authenticationService" />
    <property name="mailService" ref="mailService" />
    <property name="translationService" ref="translationService" />
    <property name="userService" ref="userService" />
    <property name="userNotificationService" ref="userNotificationService" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="homeFolderMappingDAO" ref="homeFolderMappingDAO" />
    <property name="individualMappingDAO" ref="individualMappingDAO" />
    <property name="individualDAO" ref="individualDAO" />
    <property name="genericDAO" ref="genericDAO" />
  </bean>

  <bean id="userSearchService" class="org.libredemat.service.users.impl.UserSearchService">
    <property name="individualDAO" ref="individualDAO"/>
    <property name="adultDAO" ref="adultDAO" />
    <property name="childDAO" ref="childDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO"/>
    <property name="homeFolderMappingDAO" ref="homeFolderMappingDAO"/>
    <property name="individualMappingDAO" ref="individualMappingDAO"/>
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
  </bean>

  <bean id="userDeduplicationService" class="org.libredemat.service.users.impl.UserDeduplicationService">
    <property name="adultDAO" ref="adultDAO" />
    <property name="childDAO" ref="childDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="individualDAO" ref="individualDAO" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="userWorkflowService" ref="userWorkflowService" />
    <property name="userCoherenceService" ref="userCoherenceService" />
    <property name="homeFolderMappingDAO" ref="homeFolderMappingDAO" />
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
    <property name="externalService" ref="externalService" />
  </bean>

  <bean id="userSynchronisationService" class="org.libredemat.service.users.impl.UserSynchronisationService">
    <property name="userSearchService" ref="userSearchService" />
    <property name="userWorkflowService" ref="userWorkflowService" />
    <property name="translationService" ref="translationService" />
    <property name="userDeduplicationService" ref="userDeduplicationService" />
    <property name="userNotificationService" ref="userNotificationService" />
  </bean>

  <bean id="userCoherenceService" class="org.libredemat.service.users.impl.UserCoherenceService">
      <property name="homeFolderDAO" ref="homeFolderDAO" />
      <property name="individualDAO" ref="individualDAO" />
      <property name="homeFolderMappingDAO" ref="homeFolderMappingDAO" />
      <property name="externalHomeFolderService" ref="externalHomeFolderService" />
      <property name="authenticationService" ref="authenticationService" />
      <property name="userWorkflowService" ref="userWorkflowService" />
      <property name="requestDAO" ref="requestDAO" />
  </bean>

  <bean id="userSearchServiceToHasLegalResponsiblesCheckInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.service.users.HasLegalResponsiblesCheck.setUserSearchService" />
    <property name="arguments">
      <list>
        <ref local="userSearchService" />
      </list>
    </property>
  </bean>

  <bean id="userSearchServiceToUserUtilsInjector"
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.libredemat.util.UserUtils.setUserSearchService" />
    <property name="arguments">
      <list>
        <ref local="userSearchService" />
      </list>
    </property>
  </bean>

  <bean id="meansOfContactService" class="org.libredemat.service.users.impl.MeansOfContactService">
    <property name="meansOfContactDAO" ref="meansOfContactDAO" />
  </bean>
  
  <bean id="externalHomeFolderService" class="org.libredemat.service.users.external.impl.ExternalHomeFolderService">
    <property name="genericDAO" ref="genericDAO" />
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="homeFolderMappingDAO" ref="homeFolderMappingDAO" />
  </bean>

  <bean id="homeFolderDocumentService" class="org.libredemat.service.users.impl.HomeFolderDocumentService">
    <property name="homeFolderDAO" ref="homeFolderDAO" />
    <property name="documentDAO" ref="documentDAO" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="documentTypeDAO" ref="documentTypeDAO" />
  </bean>

  <!-- ********************** INSTANCE REQUESTS SERVICES ***********************  -->

  <bean id="schoolRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.SchoolRegistrationRequestService" 
    parent="requestService">
    <property name="label" value="School Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="schoolTransportRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.SchoolTransportRegistrationRequestService" 
    parent="requestService">
    <property name="label" value="School Transport Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="globalSchoolRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.GlobalSchoolRegistrationRequestService" 
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_gsrr"/>
    <property name="label" value="Global School Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="renewalPerischoolActivitiesRequestService" 
    class="org.libredemat.service.request.school.impl.RenewalPerischoolActivitiesRequestService" 
    parent="requestService">
    <property name="label" value="Renewal Perischool Activities"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="leisureCenterRegistrationRequestService"
    class="org.libredemat.service.request.school.impl.LeisureCenterRegistrationRequestService"
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_lcrr"/>
    <property name="label" value="Leisure Center Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="holidayCampRegistrationRequestService"
    class="org.libredemat.service.request.school.impl.HolidayCampRegistrationRequestService"
    parent="requestService">
    <property name="label" value="Holiday Camp Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="supportMultiple" value="true" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="pessacAnimationRequestService" 
    class="org.libredemat.service.request.school.impl.PessacAnimationRequestService" 
    parent="requestService">
    <property name="label" value="Pessac Animation"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="perischoolActivityRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.PerischoolActivityRegistrationRequestService" 
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_parr"/>
    <property name="label" value="Perischool Activity Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="recreationActivityRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.RecreationActivityRegistrationRequestService" 
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_rarr"/>
    <property name="label" value="Recreation Activity Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="schoolCanteenRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.SchoolCanteenRegistrationRequestService" 
    parent="requestService">
    <!-- Service specific -->
    <property name="localReferentialFilename" value="local_referential_scrr"/>
    <property name="label" value="School Canteen Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="studyGrantRequestService"
    class="org.libredemat.service.request.school.impl.StudyGrantRequestService"
    parent="requestService">
    <!-- Service specific -->
    <property name="label" value="Study Grant"/>
    <property name="localReferentialFilename" value="local_referential_sgr"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="localReferentialService" ref="localReferentialService" />
    <property name="requestExternalActionService" ref="requestExternalActionService" />
    <property name="requestSearchService" ref="requestSearchService" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="requestDAO" ref="requestDAO" />
    <property name="requestExternalActionDAO" ref="requestExternalActionDAO" />
    <property name="genericDAO" ref="genericDAO" />
  </bean>

  <bean id="sportsAssociationsGrantRequestService"
    class="org.libredemat.service.request.social.impl.SportsAssociationsGrantRequestService"
    parent="requestService">
    <!-- Service specific -->
    <property name="label" value="Sports Associations Grant"/>
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="social" />
    <property name="filingDelay" value="12"/>
  </bean>
  
  <bean id="learningActivitiesDiscoveryRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.LearningActivitiesDiscoveryRegistrationRequestService"
    parent="requestService">
    <property name="label" value="Learning Activities Discovery Registration"/>
    <property name="localReferentialFilename" value="local_referential_ladrr"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
  </bean>
  
  <bean id="homeEmergencyRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.HomeEmergencyRegistrationRequestService"
    parent="requestService">
    <property name="label" value="Home Emergency Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
    <property name="supportMultiple" value="true" />
    <property name="supportUnregisteredCreation" value="true" />
  </bean>
  
  <bean id="dayCareCenterRegistrationRequestService" 
    class="org.libredemat.service.request.school.impl.DayCareCenterRegistrationRequestService"
    parent="requestService">
    <property name="label" value="Day Care Center Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="school" />
    <property name="filingDelay" value="12"/>
    <property name="userSearchService" ref="userSearchService" />
  </bean>

  <bean id="bafaGrantRequestService"
    class="org.libredemat.service.request.social.impl.BafaGrantRequestService"
    parent="requestService">
    <!-- Service specific -->
    <property name="label" value="Bafa Grant"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_INDIVIDUAL" />
    <property name="defaultDisplayGroup" value="social" />
    <property name="filingDelay" value="12"/>
  </bean>

 <bean id="birthDetailsRequestService" 
    class="org.libredemat.service.request.civil.impl.BirthDetailsRequestService" 
    parent="requestService">
    <property name="supportUnregisteredCreation" value="true" />
    <property name="label" value="Birth Details"/>
    <property name="defaultDisplayGroup" value="civil" />
 </bean>
  
  <bean id="marriageDetailsRequestService" 
    class="org.libredemat.service.request.civil.impl.MarriageDetailsRequestService" 
    parent="requestService">
    <property name="supportUnregisteredCreation" value="true" />
    <property name="label" value="Marriage Details" />
    <property name="defaultDisplayGroup" value="civil" />
  </bean>
  
  <bean id="deathDetailsRequestService" 
    class="org.libredemat.service.request.civil.impl.DeathDetailsRequestService" 
    parent="requestService">
    <property name="supportUnregisteredCreation" value="true" />
    <property name="label" value="Death Details" />
    <property name="defaultDisplayGroup" value="civil" />
   </bean>

  <bean id="standardElectoralRollRegistrationRequestService" 
    class="org.libredemat.service.request.election.impl.StandardElectoralRollRegistrationRequestService" 
    parent="requestService">
    <property name="label" value="Standard Electoral Roll Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="election" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="alignmentCertificateRequestService" 
    class="org.libredemat.service.request.urbanism.impl.AlignmentCertificateRequestService" 
    parent="requestService">
    <property name="supportUnregisteredCreation" value="true"/>
    <property name="label" value="Alignment Certificate"/>
    <property name="defaultDisplayGroup" value="urbanism" />
  </bean>

  <bean id="alignmentNumberingConnectionRequestService"
    class="org.libredemat.service.request.urbanism.impl.AlignmentNumberingConnectionRequestService"
    parent="requestService">
    <property name="label" value="Alignment Numbering Connection"/>
    <property name="defaultDisplayGroup" value="urbanism" />
  </bean>

  <bean id="sewerConnectionRequestService" 
    class="org.libredemat.service.request.urbanism.impl.SewerConnectionRequestService" 
    parent="requestService">
    <property name="supportUnregisteredCreation" value="true"/>
    <property name="label" value="Sewer Connection"/>
    <property name="defaultDisplayGroup" value="urbanism" />
  </bean>

  <bean id="libraryRegistrationRequestService" 
    class="org.libredemat.service.request.leisure.culture.impl.LibraryRegistrationRequestService" 
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_lrr"/>
    <property name="label" value="Library Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_INDIVIDUAL" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="culture" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="musicSchoolRegistrationRequestService" 
    class="org.libredemat.service.request.leisure.music.impl.MusicSchoolRegistrationRequestService" 
    parent="requestService">
    <property name="localReferentialFilename" value="local_referential_msrr"/>
    <property name="label" value="Music School Registration"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_INDIVIDUAL" />
    <property name="isOfRegistrationKind" value="true"/>
    <property name="defaultDisplayGroup" value="leisure" />
    <property name="filingDelay" value="12"/>
  </bean>

  <bean id="ticketBookingRequestService"
    class="org.libredemat.service.request.reservation.impl.TicketBookingRequestService"
    parent="requestService">
    <property name="label" value="Ticket Booking"/>
    <property name="localReferentialFilename" value="local_referential_tbr"/>
    <property name="externalReferentialFilename" value="external_referential_tor"/>
    <property name="supportUnregisteredCreation" value="true"/>
    <property name="defaultDisplayGroup" value="culture" />
    <property name="ticketBookingService" ref="ticketBookingService" />
    <property name="paymentService" ref="paymentService" />
  </bean>
  
  <bean id="remoteSupportRequestService" 
    class="org.libredemat.service.request.social.impl.RemoteSupportRequestService" 
    parent="requestService">
    <property name="label" value="Remote Support"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="defaultDisplayGroup" value="social" />
  </bean>
  
  <bean id="domesticHelpRequestService" 
    class="org.libredemat.service.request.social.impl.DomesticHelpRequestService" 
    parent="requestService">
    <property name="label" value="Domestic Help"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="defaultDisplayGroup" value="social" />
  </bean>
  
  <bean id="handicapCompensationAdultRequestService" 
    class="org.libredemat.service.request.social.impl.HandicapCompensationAdultRequestService" 
    parent="requestService">
    <property name="label" value="Handicap Compensation Adult"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="defaultDisplayGroup" value="social" />
  </bean>
  
  <bean id="handicapCompensationChildRequestService" 
    class="org.libredemat.service.request.social.impl.HandicapCompensationChildRequestService" 
    parent="requestService">
    <property name="label" value="Handicap Compensation Child"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="defaultDisplayGroup" value="social" />
  </bean>  

  <bean id="militaryCensusRequestService" 
    class="org.libredemat.service.request.military.impl.MilitaryCensusRequestService" 
    parent="requestService">
    <property name="label" value="Military Census"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
    <property name="defaultDisplayGroup" value="civil" />
  </bean>
  
   <bean id="smsNotificationRequestService" 
    class="org.libredemat.service.request.leisure.impl.SmsNotificationRequestService" 
    parent="requestService">
    <property name="label" value="Sms Notification"/>
    <property name="localReferentialFilename" value="local_referential_snr"/>
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="defaultDisplayGroup" value="leisure" />
  </bean>

  <bean id="bulkyWasteCollectionRequestService" 
    class="org.libredemat.service.request.environment.impl.BulkyWasteCollectionRequestService" 
    parent="requestService">
    <property name="label" value="Bulky Waste Collection"/>
    <property name="localReferentialFilename" value="local_referential_bwcr"/>
    <property name="defaultDisplayGroup" value="environment" />
  </bean>

  <bean id="compostableWasteCollectionRequestService" 
    class="org.libredemat.service.request.environment.impl.CompostableWasteCollectionRequestService" 
    parent="requestService">
    <property name="label" value="Compostable Waste Collection"/>
    <property name="localReferentialFilename" value="local_referential_cwcr"/>
    <property name="defaultDisplayGroup" value="environment" />
  </bean>

  <bean id="holidaySecurityRequestService"
    class="org.libredemat.service.request.localpolice.impl.HolidaySecurityRequestService"
    parent="requestService">
    <property name="label" value="Holiday Security" />
    <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
    <property name="defaultDisplayGroup" value="security" />
  </bean>

  <bean id="technicalInterventionRequestService"
    class="org.libredemat.service.request.technical.impl.TechnicalInterventionRequestService"
    parent="requestService">
    <property name="label" value="Technical Intervention" />
    <property name="localReferentialFilename" value="local_referential_tir"/>
    <property name="defaultDisplayGroup" value="technical" />
  </bean>

  <bean id="youthCenterRegistrationRequestService"
    class="org.libredemat.service.request.leisure.impl.YouthCenterRegistrationRequestService"
    parent="requestService">
    <property name="label" value="Youth Center Registration" />
    <property name="defaultDisplayGroup" value="leisure" />
    <property name="supportUnregisteredCreation" value="false" />
    <property name="filingDelay" value="12" />
    <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
  </bean>

  <bean id="reservationService" class="org.libredemat.service.reservation.impl.ReservationService">
      <property name="reservationDAO" ref="reservationDAO" />
  </bean>

  <bean id="parkCardRequestService" class="org.libredemat.service.request.parking.impl.ParkCardRequestService" parent="requestService" >
      <property name="label" value="Park Card" />
      <property name="localReferentialFilename" value="local_referential_pcr" />
      <property name="defaultDisplayGroup" value="urbanism" />
      <property name="filingDelay" value="12" />
      <property name="subjectPolicy" value="SUBJECT_POLICY_ADULT" />
      <property name="supportUnregisteredCreation" value="false" />
      <property name="supportMultiple" value="true" />
      <property name="paymentDAO" ref="paymentDAO" />
      <property name="requestDAO" ref="requestDAO" />
      <property name="individualDAO" ref="individualDAO" />
      <property name="paymentService" ref="paymentService" />
      <property name="requestActionService" ref="requestActionService" />
      <property name="requestLockService" ref="requestLockService" />
      <property name="parkCardService" ref="parkCardService" />
      <property name="localReferentialService" ref="localReferentialService" />
  </bean>

  <bean id="schoolRegistrationWithRemoteCirilnetenfanceRequestService" class="org.libredemat.service.request.school.impl.SchoolRegistrationWithRemoteCirilnetenfanceRequestService" parent="requestService" >
      <property name="label" value="School Registration With Remote Cirilnetenfance" />
      <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
      <property name="defaultDisplayGroup" value="school" />
      <property name="filingDelay" value="12" />
      <property name="isOfRegistrationKind" value="true" />
  </bean>

    <bean id="childCareCenterRegistrationRequestService" class="org.libredemat.service.request.school.impl.ChildCareCenterRegistrationRequestService" parent="requestService" >
      <property name="userWorkflowService" ref="userWorkflowService" />
      <property name="userSearchService" ref="userSearchService" />
      <property name="localReferentialFilename" value="local_referential_cccrr" />
      <property name="label" value="Child Care Center Registration" />
      <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
      <property name="defaultDisplayGroup" value="childCare" />
      <property name="filingDelay" value="12" />
    </bean>

    <bean id="recreationActivityPolyRegistrationRequest" class="org.libredemat.service.request.school.impl.RecreationActivityPolyRegistrationRequestService" parent="requestService" >
      <property name="localReferentialFilename" value="local_referential_raprr" />
      <property name="label" value="Recreation Activity Poly Registration" />
      <property name="subjectPolicy" value="SUBJECT_POLICY_CHILD" />
      <property name="defaultDisplayGroup" value="school" />
      <property name="filingDelay" value="12" />
      <property name="isOfRegistrationKind" value="true" />
      <property name="supportMultiple" value="true" />
    </bean>

	<!-- Parking Permit Temporary Relocation -->
	<bean id="parkingPermitTemporaryRelocationRequestService" class="org.libredemat.service.request.permit.impl.ParkingPermitTemporaryRelocationRequestService"
		parent="requestService">
		<property name="label" value="Parking Permit Temporary Relocation" />
		<property name="localReferentialFilename" value="local_referential_pptrr" />
		<property name="supportUnregisteredCreation" value="false" />
		<property name="defaultDisplayGroup" value="permit" />
		<property name="filingDelay" value="12" />
		<property name="paymentService" ref="paymentService" />
		<property name="requestActionService" ref="requestActionService" />
		<property name="requestLockService" ref="requestLockService" />
		<property name="userSearchService" ref="userSearchService" />
	</bean>

	<bean id="parkingPermitTemporaryWorkRequestService" class="org.libredemat.service.request.permit.impl.ParkingPermitTemporaryWorkRequestService"
		parent="requestService">
		<property name="label" value="Parking Permit Temporary Work" />
		<property name="localReferentialFilename" value="local_referential_pptwr" />
		<property name="supportUnregisteredCreation" value="false" />
		<property name="defaultDisplayGroup" value="permit" />
		<property name="filingDelay" value="12" />
		<property name="paymentService" ref="paymentService" />
		<property name="requestActionService" ref="requestActionService" />
		<property name="requestLockService" ref="requestLockService" />
		<property name="userSearchService" ref="userSearchService" />
	</bean>

  <bean id="conflansMunicipalWasteRequestService"
    class="org.libredemat.service.request.environment.impl.ConflansMunicipalWasteRequestService"
    parent="requestService">
    <property name="label" value="Conflans Municipal Waste"/>
    <property name="localReferentialFilename" value="local_referential_cmwr"/>
    <property name="defaultDisplayGroup" value="environment" />
  </bean>

  <bean id="displayGroupService" class="org.libredemat.service.request.impl.DisplayGroupService">
    <property name="genericDAO" ref="genericDAO" />
    <property name="requestTypeDAO" ref="requestTypeDAO" />
    <property name="requestServiceRegistry" ref="requestServiceRegistry" />
  </bean>

  <!-- *******************************************************************  -->
  <!-- *******************    PAYMENT SERVICES    ************************  -->
  <!-- *******************************************************************  -->

  <bean id="paymentFilterAspect"
    class="org.libredemat.service.payment.aspect.PaymentFilterAspect" />

  <bean id="paymentContextCheckAspect" 
    class="org.libredemat.service.payment.aspect.PaymentContextAspect">
    <property name="paymentDAO" ref="paymentDAO" />
  </bean>

  <bean id="paymentService" class="org.libredemat.service.payment.impl.PaymentService">
    <property name="genericDAO" ref="genericDAO" />
    <property name="paymentDAO" ref="paymentDAO" />
    <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
    <property name="mailService" ref="mailService" />
    <property name="userSearchService" ref="userSearchService" />
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
    <property name="paymentExternalService" ref="paymentExternalService" />
    <property name="externalApplicationService" ref="externalApplicationService" />
  </bean>

  <bean id="externalApplicationProviderService"
    parent="externalProviderServiceAdapter"
    class="org.libredemat.service.payment.external.ExternalApplicationProviderService">
    <property name="paymentService" ref="paymentService" />
  </bean>

  <bean id="paymentExternalService" class="org.libredemat.service.payment.external.impl.PaymentExternalService"
      parent="externalService">
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
    <property name="paymentDAO" ref="paymentDAO" />
  </bean>

  <bean id="externalApplicationService" class="org.libredemat.service.payment.external.impl.ExternalApplicationService">
    <property name="adultDAO" ref="adultDAO" />
    <property name="genericDAO" ref="genericDAO" />
    <property name="externalHomeFolderService" ref="externalHomeFolderService" />
  </bean>

  <!-- ======================================================= -->
  <!-- =================== DAO DEFINITION ==================== -->  
  <!-- ======================================================= -->

  <bean id="genericDAO" class="org.libredemat.dao.jpa.GenericDAO" />

  <bean id="requestDAO" class="org.libredemat.dao.request.hibernate.RequestDAO" >
      <property name="genericDAO" ref="genericDAO" />
  </bean>

  <bean id="reservationDAO" class="org.libredemat.dao.reservation.hibernate.ReservationDAO" />

  <bean id="requestStatisticsDAO" class="org.libredemat.dao.request.hibernate.RequestStatisticsDAO" />

  <bean id="requestTypeDAO" class="org.libredemat.dao.request.hibernate.RequestTypeDAO" />

  <bean id="requestFormDAO" class="org.libredemat.dao.request.hibernate.RequestFormDAO" />

  <bean id="documentTypeDAO" class="org.libredemat.dao.document.hibernate.DocumentTypeDAO" />

  <bean id="requestActionDAO" class="org.libredemat.dao.request.hibernate.RequestActionDAO" />

  <bean id="requestNoteDAO" class="org.libredemat.dao.request.hibernate.RequestNoteDAO" />

  <bean id="localAuthorityDAO" class="org.libredemat.dao.authority.hibernate.LocalAuthorityDAO" />

  <bean id="categoryDAO" class="org.libredemat.dao.request.hibernate.CategoryDAO" />

  <bean id="agentDAO" class="org.libredemat.dao.authority.hibernate.AgentDAO" />

  <bean id="schoolDAO" class="org.libredemat.dao.authority.hibernate.SchoolDAO" />

  <bean id="recreationCenterDAO" class="org.libredemat.dao.authority.hibernate.RecreationCenterDAO" />

  <bean id="individualDAO" class="org.libredemat.dao.users.hibernate.IndividualDAO" />

  <bean id="adultDAO" class="org.libredemat.dao.users.hibernate.AdultDAO" parent="individualDAO"/>

  <bean id="childDAO" class="org.libredemat.dao.users.hibernate.ChildDAO" parent="individualDAO"/>

  <bean id="homeFolderDAO" class="org.libredemat.dao.users.hibernate.HomeFolderDAO" />

  <bean id="documentDAO" class="org.libredemat.dao.document.hibernate.DocumentDAO" />

  <bean id="paymentDAO" class="org.libredemat.dao.payment.hibernate.PaymentDAO" />

  <bean id="meansOfContactDAO" class="org.libredemat.dao.users.hibernate.MeansOfContactDAO" />

  <bean id="requestExternalActionDAO" class="org.libredemat.dao.request.external.hibernate.RequestExternalActionDAO"  />
  
  <bean id="ticketBookingDAO" class="org.libredemat.dao.request.hibernate.TicketBookingDAO" />

  <bean id="homeFolderMappingDAO" class="org.libredemat.dao.users.hibernate.HomeFolderMappingDAO" />

  <bean id="parkCardDAO" class="org.libredemat.dao.request.hibernate.ParkCardDAO" />

  <bean id="individualMappingDAO" class="org.libredemat.dao.users.hibernate.IndividualMappingDAO" />
  
  <bean id="localReferentialDAO" class="org.libredemat.dao.request.xml.LocalReferentialDAO">
      <property name="requestServiceRegistry" ref="requestServiceRegistry" />
      <property name="localAuthorityRegistry" ref="localAuthorityRegistry" />
      <property name="translationService" ref="translationService" />
  </bean>

  <bean id="informationRequestService" class=" org.libredemat.service.request.impl.InformationRequestService" parent="requestService">
      <property name="localReferentialFilename" value="local_referential_ir" />
      <property name="supportUnregisteredCreation" value="true" />
      <property name="label" value="Information"/>
</bean>

</beans>
