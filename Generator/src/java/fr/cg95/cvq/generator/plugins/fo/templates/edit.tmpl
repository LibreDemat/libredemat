<% 
   import org.apache.commons.lang.StringUtils
   import groovy.text.SimpleTemplateEngine
   import java.io.File
   import java.io.IOException
   import java.io.FileOutputStream
   
   namespaceAlias = foObject.namespaceAlias 
   requestName = foObject.requestName
   steps = foObject.stepMap
   conditionsName = foObject.conditionsNames

   def messageForMe = { text ->  
		println text
		
   } 
%>
<html>
  <head>
    <meta name="layout" content="fong_main" />
    <script type="text/javascript" src="\${createLinkTo(dir:'js/frontoffice',file:'condition.js')}"></script>
  </head>  
  <body>
      <h2 class="request-creation">
<!--      <a href="#" id="requestSubmit">envoyer</a>-->
      <g:render template="/frontofficeRequestType/widget/requestDesc" model="[requestType: ${namespaceAlias}]"/> 
      <span><g:message code="${namespaceAlias}.duration.label" /><strong><g:message code="${namespaceAlias}.duration.value" /></strong></span>
      <span>
        Documents à fournir :
        <strong>Pièce d'identité</strong>, 
        <strong class="mandatory">Livret de famille</strong>
      </span>
    </h2>
  <div id="yui-main"> 
    <div id="main" class="yui-b">
       <div id="requestTabView" class="yui-navset">
         <ul class="yui-nav">
         <%
			Integer i = 0
			steps.each {
				step = steps.get(i)
		 %> 
         <li class="\${currentTab == 'tab${step.index + 1}' ? 'selected' : ''}"><a href="#tab${step.index + 1}"><em>
             <span class="tag-no_right">${step.index + 1}</span>
             <span class="tag-rejected"><g:message code="${namespaceAlias}.step.tag.rejected.short" /></span>
             <g:message code="${namespaceAlias}.step.${step.name}.label" />
           </em></a></li>
         
		 <%		i ++
			}
		 %>
		 </ul>
         <div class="yui-content">
         <%
			i = 0
			steps.each {
				step = steps.get(i) 
		 %>
           <div id="tab${step.index + 1}">
             <form method="POST" action="<g:createLink action="valid${StringUtils.capitalize(step.name)}" />">
               <h3>
                 <span class="tag-rejected"><g:message code="${namespaceAlias}.step.tag.rejected"/></span>
                 <g:message code="${namespaceAlias}.step.${step.name}.label" />
                 <span><g:message code="${namespaceAlias}.step.${step.name}.desc" /></span>
               </h3>
               
               <g:render template="/frontofficeRequestType/${StringUtils.uncapitalize(foObject.requestName)}/steps/${step.name}" /> 
               
               <!-- Input submit-->
               <input type="submit" 
		           name="submit${StringUtils.capitalize(namespaceAlias)}${StringUtils.capitalize(step.name)}" 
		           value="<g:message code='${namespaceAlias}.step.${step.name}.submitLabel'/>" />
             </form>
             <!-- navigation link -->
             <div class="navTab">
               <%  
               	if (step.index != 0) { 
               %>
               <a href="#tab${step.index}" class="prevTab"><g:message code="${namespaceAlias}.step.navigation.previous"/></a><% }%>
               <% 
                 if (step.index != steps.size() - 1) {
               %>
               <a href="#tab${step.index + 2}" class="nextTab"><g:message code="${namespaceAlias}.step.navigation.next"/></a><% }%>
             </div>
           </div>  
         <%		i ++
			}
		 %>        
       	 </div><!-- end yui-content -->
       </div><!-- end requestTabView -->
 	  
<div class="helpBox">
        <h3>Aide</h3>
        <dl>
          <dt>Sujet</dt>
          <dd>
            Afin d'améliorer la communication et les échanges et de favoriser la participation 
            et la contribution, le projet CapDémat se dote de nouveaux moyens de discussion
          </dd>
          <dt>Documents</dt>
          <dd>
            Afin d'améliorer la communication et les échanges et de favoriser la participation 
          </dd>
          <dt>Formulaire</dt>
          <dd>
             et la contribution, le projet CapDémat se dote de nouveaux moyens de discussion
            Afin d'améliorer la communication et les échanges et de favoriser la participation
          </dd>
          <dt>Moyen de contact</dt>
          <dd>
            de favoriser la participation 
            et la contribution, le projet CapDémat se dote de nouveaux moyens de discussion
          </dd>
        </dl>
      </div>
     
     </div> <!-- end main -->
    </div> <!-- end yui-main -->

    <div id="narrow" class="yui-b">
      
      <div id="requestSubject" class="requestBox">
        <h3>
          <span class="tag-validated">v</span>
          <em>Sujet de la demande</em>
        </h3>
        <div class="body">
          <strong>M. Hervé Martin</strong>
          <a href="#">choisir un autre sujet</a>
        </div>
      </div>
      
      <div id="requestMeansOfContact" class="requestBox">
        <h3>
          <em>Moyen de contact</em>
        </h3>
        <div class="body">
          <form action="#">
            <select name="requestMeansOfContactSelect">
              <option>Courriel</option>
              <option>Téléphone</option>
              <option>Courrier</option>
              <option>SMS</option>
              <option>Mobile</option>
            </select>
          </form>
        </div>
      </div>
     
      <div id="requestDocument" class="requestBox">
        <h3>
          <span class="tag-rejected">r</span>
          <em>Documents à fournir</em>
        </h3>
        <div class="body">
          <ul>
            <li>
              <span class="tag-rejected">r</span> 
              <a href="#"><strong>Pièce d'identité</strong></a>
            </li>
            <li>
              <span class="tag-validated">v</span> 
              <a href="#"><strong>Livret de famille</strong></a>
            </li>
          </ul>
        </div>
      </div>
    
      <!-- 
      <div class="nobox">
        <h3>Broullons</h3>
        <ul>
         <li><span class="tag-validated">complet</span>Demande d'assistance à distance </li>
         <li><span class="tag-validated">complet</span>Inscription scolair</li>
         <li><span class="tag-pending">partiel</span>Inscription à la cantine scolaire</li>
        </ul>
      </div>
      -->
      
      <!--
      <h3>Denières demandes</h3>
      <ul>
       <li><span class="tag-pending">traitée</span>Demande d'assistance à distance - 12/08/2008</li>
       <li><span class="tag-validated">validée</span>Inscription scolair - 10/08/2008</li>
       <li><span class="tag-rejected">annulée</span>Inscription à la cantine scolaire - 10/08/2008</li>
      </ul>

      <h3>Documents</h3>
      <ul>
       <li>Carte d'identité - rafik</li>
       <li>Passeport - superman</li>
       <li>Lvret de famille - Zenexity</li>
       <li>Justificatif de domocile - rue Taitbout</li>
      </ul>

      <h3>Compte famille</h3>
      <ul>
       <li>Rafik DJEJDIG - 10/10/1910</li>
       <li>Rafik DJEJDIG - 10/10/1910</li>
       <li>Rafik DJEJDIG - 10/10/1910</li>
       <li>Rafik DJEJDIG - 10/10/1910</li>
      </ul>
      -->     
    </div><!-- end of narrow -->
    <script type="text/javascript">
      // next Links
      var activeNextTabByLink = function(e) {
	      YAHOO.util.Event.preventDefault(e);
        var requestFormTabView = new YAHOO.widget.TabView('requestTabView');
	      var activeTabIndex = requestFormTabView.get('activeIndex');
	      requestFormTabView.set('activeIndex' , activeTabIndex + 1);
      }
      
      YAHOO.util.Event.addListener(
          YAHOO.util.Dom.getElementsByClassName("nextTab", "a" ),
          "click", 
          activeNextTabByLink
      );
      
      // prev Links
      var activePrevTabByLink = function(e) {
	      YAHOO.util.Event.preventDefault(e);
        var requestFormTabView = new YAHOO.widget.TabView('requestTabView');
	      var activeTabIndex = requestFormTabView.get('activeIndex');
	      requestFormTabView.set('activeIndex' , activeTabIndex - 1);
      }
      
      YAHOO.util.Event.addListener(
          YAHOO.util.Dom.getElementsByClassName("prevTab", "a" ),
          "click", 
          activePrevTabByLink
      );

 	  function checkAllConditions() {
      	<%
      		def conditionsParam = ""
      		conditionsName.each {	
      			conditionsParam += '"' + it + '", '  
      		}
      	%>
      	var conditionsName = [${conditionsParam.substring(0, conditionsParam.length() - 2)}];
        Condition.checkConditions(conditionsName, "${StringUtils.uncapitalize(requestName)}");
      }
      
      function conditionChange(e) {
      	Condition.change(this.className, "${StringUtils.uncapitalize(requestName)}");
      }
      
      // CONDITION TRIGGER
	  YAHOO.util.Event.addListener(
        YAHOO.util.Dom.getElementsByClassName("*trigger", "select" ),
        "change", 
        conditionChange
      );
        
      // CONDITION TRIGGER
	  YAHOO.util.Event.addListener(
        YAHOO.util.Dom.getElementsByClassName("*trigger", "input" ),
        "change", 
        conditionChange
      );
         
	  YAHOO.util.Event.onDOMReady(checkAllConditions);
	  
	  // Request TabView Initialization
    function initRequest() {
      var requestFormTabView = new YAHOO.widget.TabView('requestTabView');
    }

    YAHOO.util.Event.onDOMReady(initRequest);
   </script>

  </body>
</html>
