#macro (requiredFields $state)
#if ($state.Mode!="static")
#if($state.Mode!="noreturn")
#if($state.Mode!="full")
Les * indiquent des zones de saisie obligatoires
#end
#end
#end
#end
#macro (contentId $state)
#if ($state)
#if ($state.Mode == "full")
content_full#else
content#end
#else
content#end
#end
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
#if (${wizard.baseReference($httprequest)})
	<base href="${wizard.baseReference($httprequest)}" />
#end
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="author" content="GUIWizard" />
	<meta name="description" content="Teleprocedure display wizard generated page." />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="expires" content="-1" />

	<title>CapDémat : ${wizardstate.SiteTitle}</title>
	<link rel="stylesheet" type="text/css" media="screen" href="assets/common/css/new/process/structure.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="assets/common/css/new/process/common.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="assets/common/css/new/process/form.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="assets/common/css/new/process/colors.css" />
</head>

<!-- ${wizard.getVersion($httprequest)} -->

<body id="body" onkeypress="javascript:processDefaultButton(event);">
#************************************************************************************
 * Include javascript source files
 *#
#if (${wizard.getTimeout($httprequest)})
<script type="text/javascript">
	setTimeout("timeoutRedirect()",${wizard.getTimeout($httprequest)});
	function timeoutRedirect(){ location.href="${wizard.getTimeoutHref($httprequest)}"; }
</script>
#end

#foreach ($script in $global.ScriptArray)
  #if (${script.Src} != "")
<script type="text/javascript" src="${script.Src}">
</script>
  #end
#end

#foreach ($script in $process.ScriptArray)
  #if (${script.Src} != "")
<script type="text/javascript" src="${script.Src}">
</script>
  #end
#end

#foreach ($script in $stage.ScriptArray)
  #if (${script.Src} != "")
<script type="text/javascript" src="${script.Src}">
</script>
  #end
#end

  <div id="mainframe">
    <div id="header">
      <div id="logo"><a href="http://www.capwebct.fr" title=""><img src="img/logo_capwebct.gif" alt="" /></a></div>
      <div id="banner"><img src="assets/common/img/banner.jpg" alt="" /></div>
    </div>
#set ($state = $wizard.getState($stage, $wizardstate.State))
#if ($state.mode != "full")
    <div id="context">
#************************************************************************************
 * Construct stage side-bar
 * 
 *  - if we have stages already validated display help to select stage items
 *  - for each stage display either the validated stage item(s), or an optionel notice message
 *#
#if ($state.mode != "noreturn")

#if ($wizard.validStages($wizardstate))
      <div class="context_block_notice">
        <p class="notice">cliquez sur un des éléments ci-dessous pour le modifier</p>
      </div>
#end
#set ($index = 0)
#foreach ($def in $wizardstate.StageArray)
  #set ($stagedef = $wizard.getWizardStage($def))
      <div class="context_block">
        <h1>${stagedef.Caption.toUpperCase()}</h1>
  #if ($wizard.validStage($wizardstate, $index))
	#foreach ($select in $wizard.getSelectedLists($stagedef))
      #if ($wizard.getItems($httprequest, $select))
        #set ($indey = 0)
        #foreach ($item in $wizard.getItems($httprequest, $select))
          #set ($itemType = $wizard.displayItemType($select.DisplayArray))
		  #set ($style = "")
          #if ($itemType == "people")
            #set ($style = "context_link context_people_ok")
          #elseif ($itemType == "document")
            #set ($style = "context_link context_document_ok")
          #elseif ($itemType == "assets")
            #set ($style = "context_link context_document_ok")
          #elseif ($itemType == "donation")
            #set ($style = "context_link context_document_ok")
          #elseif ($itemType == "capital")
            #set ($style = "context_link context_document_ok")
          #elseif ($itemType == "savings")
            #set ($style = "context_link context_document_ok")
          #elseif ($itemType == "taxes")
            #set ($style = "context_link context_document_ok")
          #end
        <h4><a href="${wizard.hrefLink($wizardstate, $index,$select,$item,$indey)}" title="" class="${style}"><span class="custom_color"></span>${wizard.displayItem($item,$select.DisplayArray,18)}</a></h4>
          #set ($indey = $indey + 1)
        #end
      #end
    #end
    #if (!$wizard.getSelectedList($stagedef,$state))
        <h4><a href="${wizard.getMenuHref($httprequest, $stagedef, $index)}" title="" class="context_link context_rule_ok"><span class="custom_color"></span>${stagedef.Caption}</a></h4>
    #end
  #elseif ($stagedef.Notice)
        <p class="notice">${stagedef.Notice}</p>
  #end
      </div>
  #set ($index = $index + 1)
#end
#end
    </div>
#end
    <div id="#contentId($state)">
      <div id="#contentId($state)_top">
        <h2>${wizard.getProcessTitle($wizardstate).toUpperCase()}#if($stage.Caption) > ${stage.Caption}#end</h2>
        <ul id="content_top_links">
#if ($wizard.getButtonHref($httprequest, $state, "cancel"))
          <li class="top_cancel"><a href="${wizard.getButtonHref($httprequest, $state, "cancel")}" title="">${wizard.getButtonLabel($httprequest, $state, "cancel").toUpperCase()}</a></li>
#end
          <li class="top_help"><a href="javascript:popup('assets/common/pdf/helpcapdemat.pdf');" title="">AIDE</a></li>
        </ul>
      </div>
#if ($state)
      <div id="#contentId($state)_middle">
#************************************************************************************
 * Construct the formular area
 * 
 *  - if we are in between stages we display a stage menu
 *  - display the jsp file for the formular
 *  - on the welcome page (or default page of the first stage) we optionnaly display a selection list
 *#
  #if ($wizard.stageMenu($wizardstate))
        <p class="paragraph">Vous pouvez à présent choisir de compléter votre demande en effectuant une des actions ci-dessous :</p>
        <p class="paragraph">Les étapes indiquées <span class="required">en rouge</span> sont obligatoires</p>
        <ul class="list">
    #set ($index = 0)
	#set ($accessable = true)
    #foreach ($def in $wizardstate.StageArray)
      #set ($stagedef = $wizard.getWizardStage($def))
	  #set ($styleclass = "")
      #if ($stagedef.stagemenu)
        #if ($stagedef.stagemenu == "add")
	      #set ($styleclass = "action_row_plus")
        #elseif ($stagedef.stagemenu == "display")
	      #set ($styleclass = "action_row_right")
        #end
      #end
      #if ($stagedef.required)
        #set ($postfix = '<span class="required">(OBLIGATOIRE)</span>')
      #else
        #set ($postfix = "(OPTIONNEL)")
      #end
	  #if ($styleclass != "")
        #if ($accessable)
          <li class="action_row"><a href="${wizard.getMenuHref($httprequest, $stagedef, $index)}" title="" class="${styleclass}"><span class="custom_color"></span>${wizard.getMenuCaption($stagedef).toUpperCase()} <em>${postfix}</em></a></li>
        #else
          <li class="action_row"><a href="javascript:alert('Vous devez valider les étapes obligatoires d\'abord.')" title="" class="${styleclass}"><span class="custom_color"></span>${wizard.getMenuCaption($stagedef).toUpperCase()} <em>${postfix}</em></a></li>
        #end
      #end
      #if ($stagedef.required)
        #if (!$wizard.validStage($wizardstate, $index))
          #set ($accessable = false)
        #end
      #end
      #set ($index = $index + 1)
    #end
          <li class="action_row action_row_last"><a href="${wizard.getButtonHref($httprequest, $state, "quit")}" title="" class="action_row_cancel"><span class="custom_color"></span>${wizard.getButtonLabel($httprequest, $state, "quit").toUpperCase()}</a></li>
        </ul>
  #else
        <p class="caution">#requiredFields($state)</p>
	#if ($wizard.getPageTitle($httprequest, $stage, $state))
        <fieldset class="fieldset_zone">
          <div class="fieldset_title_${wizard.getPageTitleType($httprequest, $stage, $state)}">
            <h3 class="fieldset_title">
		      ${wizard.getPageTitle($httprequest, $stage, $state)}
           </h3>
    #if ($wizard.getButtonHref($httprequest, $state, "modify"))
            <ul>
              <li class="fieldset_title_modify"><a href="${wizard.getButtonHref($httprequest, $state, "modify")}" title="">MODIFIER LES INFORMATIONS</a></li>
            </ul>
    #end
          </div>
        </fieldset>
	#end
    #foreach ($form in $state.FormArray)
	${wizard.includeJsp($pagecontext, "/newgui/",$form)}
    #end
    #if ($wizard.getSelectionList($stage, $state))
      #set ($select = $wizard.getSelectionList($stage, $state))
        <ul class="list">
          <li class="title">${select.Title} :</li>
      #if ($wizard.getItems($httprequest, $select))
        #set ($index = 0)
        #foreach ($item in $wizard.getItems($httprequest, $select))
          #set ($itemType = $wizard.displayItemType($select.DisplayArray))
		  #set ($style = "")
          #if ($itemType == "people")
            #set ($style = "people")
          #elseif ($itemType == "document")
            #set ($style = "document")
          #elseif ($itemType == "assets")
            #set ($style = "house")
          #elseif ($itemType == "donation")
            #set ($style = "document")
          #elseif ($itemType == "savings")
            #set ($style = "savings")
          #elseif ($itemType == "capital")
            #set ($style = "capital")
          #elseif ($itemType == "taxes")
            #set ($style = "document")
          #end
          <li class="${style}"><a href="${wizard.hrefLink($wizardstate, $select,$item,$index)}" title="">${wizard.displayItem($item,$select.DisplayArray,1).toUpperCase()}</a></li>
          #set ($index = $index + 1)
        #end
      #end
        </ul>
    #elseif ($wizard.getMenuList($stage, $state))
      #set ($menu = $wizard.getMenuList($stage, $state))
        <ul class="list">
          <li class="title">${menu.Title} :</li>
      #foreach ($button in $menu.ButtonArray)
          #set ($style = "document")
          <li class="${style}"><a href="${wizard.href($wizardstate, $button,"processSelect.do")}" title="">${button.StringValue.toUpperCase()}</a></li>
      #end
        </ul>
    #end
#************************************************************************************
 * Construct the navigation / button area
 *    Depending on the parameters display a delete, quit, save or navigation buttons
 *#
    #if ($state.ButtonArea != "none")
      #if ($wizard.getButtonHref($httprequest, $state, "add"))
        <ul class="actions_list">
          <li class="add"><a href="${wizard.getButtonHref($httprequest, $state, "add")}" title=""><span class="custom_color"></span>${wizard.getButtonLabel($httprequest, $state, "add").toUpperCase()}</a></li>
        </ul>
      #end
      #if ($wizard.getButtonHref($httprequest, $state, "delete"))
        <ul class="actions_list">
          <li class="cancel"><a href="${wizard.getButtonHref($httprequest, $state, "delete")}" title="">${wizard.getButtonLabel($httprequest, $state, "delete").toUpperCase()}</a></li>
        </ul>
      #end
      #if ($wizard.getButtonHref($httprequest, $state, "print"))
        <ul class="actions_list">
          <li class="print"><a href="${wizard.getButtonHref($httprequest, $state, "print")}" title="">${wizard.getButtonLabel($httprequest, $state, "print").toUpperCase()}</a></li>
        </ul>
      #end
      #if ($wizard.getButtonHref($httprequest, $state, "quit"))
        <ul class="actions_list">
          <li class="cancel"><a href="${wizard.getButtonHref($httprequest, $state, "quit")}" title="">${wizard.getButtonLabel($httprequest, $state, "quit").toUpperCase()}</a></li>
        </ul>
      #end
	  #if ($state.ButtonArea != "nonavigation")
        <fieldset class="fieldset_zone">
        <ul class="navigation_links">
          #if ($wizard.getButtonHref($httprequest, $state, "previous"))
          <li class="navigation_link_to_previous"><a href="${wizard.getButtonHref($httprequest, $state, "previous")}" title="">${wizard.getButtonLabel($httprequest, $state, "previous").toUpperCase()}</a></li>
          #end
          #if ($wizard.getButtonHref($httprequest, $state, "save"))
          <li class="navigation_link_to_next"><a href="${wizard.getButtonHref($httprequest, $state, "save")}" id="defaultbutton" title="">${wizard.getButtonLabel($httprequest, $state, "save").toUpperCase()}</a></li>
          #else
          <li class="navigation_link_to_next"><a href="${wizard.getButtonHref($httprequest, $state, "next")}" id="defaultbutton" title="">${wizard.getButtonLabel($httprequest, $state, "next").toUpperCase()}</a></li>
          #end
        </ul>
        </fieldset>
      #end
    #end
  #end
      </div>
#end
      <div id="#contentId($state)_bottom"></div>
    </div>
    <div id="footer">
      <ul>
        <li class="logo firstlogo"><a href="http://www.capwebct.fr" title="" class="info"><span class="logo_img"><img src="img/logo_capwebct.gif" alt="" /></span><span class="logo_legend">CapWebCT.</span></a></li>
        <li class="logo secondlogo"><a href="http://www.prai-idf.fr/public/rubrique.tpl?id=8364&titre=8364" title="" class="info"><span class="logo_img"><img src="img/logoUE.png" alt="" /></span><span class="logo_legend">Projet cofinancé par lUnion Européenne (FEDER).</span></a></li>
        <li class="legend"><p class="legend_text"><a href="javascript:popup('assets/common/pdf/legal.pdf');" title="">Mentions légales.</a></p></li>
        <li class="logo right"><a href="http://www.capwebct.fr" title="" class="info"><span class="logo_img"><img src="img/logo_capwebct.gif" alt="" /></span><span class="logo_legend">CapWebCT.</span></a></li>
      </ul>
    </div>
  </div>
#if ($wizardstate.Message)
<script type="text/javascript">
alert("${wizardstate.resetMessage()}");
</script>
#end

</body>
</html>