#macro (displayState $wizard $state)
  #if ($state.Title)
    <div class="macro">
      <p class="macro">${state.Title}</p>
    </div>
    #foreach ($form in $state.FormArray)
      #if ($wizard.displayForm($form))
##         <div class="grid_cell">
          ${wizard.includeJsp($form)}
##         </div>
      #end
    #end
    <div class="macro">
      <div id="button-area"#if(!$state.Background) class="transparent"#end>
        #foreach ($button in $state.ButtonArray)
          <div class="" onclick="${wizard.onClick($button)}">${button.StringValue}</div>
        #end
      </div>
    </div>
  #else
    #foreach ($form in $state.FormArray)
      #if ($wizard.displayForm($form))
##         <div class="grid_cell">
          ${wizard.includeJsp($form)}
##         </div>
      #end
    #end
    <div class="macro">
      <div id="button-area"#if(!$state.Background) class="transparent"#end>
        #foreach ($button in $state.ButtonArray)
          <div class="" onclick="${wizard.onClick($button)}">${button.StringValue}</div>
        #end
      </div>
    </div>
  #end
#end

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" >
<head>
#if (${wizard.baseReference()})
  <base href="${wizard.baseReference()}" />
#end
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="author" content="GUIWizard" />
  <meta name="description" content="Manager display wizard generated page." />
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="-1" />

  <title>CapDémat : ${wizardstate.SiteTitle}</title>

  <style type="text/css" media="all">
  #foreach ( $style in $global.StyleArray)
    @import "${style}";
  #end
  #foreach ( $style in $manager.StyleArray)
    @import "${style}";
  #end
  #foreach ( $style in $tab.StyleArray)
    @import "${style}";
  #end
  </style>
</head>

<!-- ${wizard.Version} -->

<body onload="window.defaultStatus='CapDémat : L\'administration en ligne.';" id="CapDemat">

#if (${wizard.Timeout})
  <script type="text/javascript">
    setTimeout("timeoutRedirect()",${wizard.Timeout});
    function timeoutRedirect(){ location.href="${wizard.TimeoutHref}"; }
  </script>
#end

#foreach ($script in $global.ScriptArray)
  #if (${script.Src} != "")
  <script type="text/javascript" src="${script.Src}"></script>
  #end
#end

#foreach ($script in $manager.ScriptArray)
  #if (${script.Src} != "")
  <script type="text/javascript" src="${script.Src}"></script>
  #end
#end

<div id="container">
	<div id="banner"><span>CapDémat - ${wizardstate.SiteTitle} </span><div class="productlogo">&nbsp;</div></div>
	<div id="information">
		<div id="title">
			<h1><span>CapDémat - ${wizardstate.SiteTitle} </span></h1>
			<div id="logoBO"><img src="assets/img/logoBO.jpg" /></div>
		</div>
	</div>
	<div id="navigation">
		<div id="path">
			<div class="path">${wizardstate.Application}</div>
			<div class="path">${manager.Title}</div>
			<div class="current">${tab.Title}</div>
		</div>
  #if ($wizardstate.getNavigate())
    <div id="identifier">
      <div class="user">$!{wizardstate.User}</div>
    #if (${wizard.logout()})
      <div class="logout" onclick="document.location.href='${wizard.logout()}'">${wizard.logoutLabel()}</div>
    #end
    </div>
  #end
  </div>

#if ($wizardstate.getNavigate())
  #set ($tabulationSize = "part")
#else
  #set ($tabulationSize = "full")
#end
  <div id="tabulation" class="${tabulationSize}">
    <div class="block_head">
      <div class="left"></div>
      <ul class="center">
    #foreach ($loop in $manager.TabArray)
      #set ($index = $velocityCount - 1)
      #set ($disptab = $wizard.getTabDefinition($index))
      #if (($index == 0) && ($disptab == $tab))
        <li class="element first current ${manager.Name}">${disptab.Caption}</li>
      #elseif ($index == 0)
        <li class="element first link ${manager.Name}" onclick="${wizard.getTabAction($disptab,$index)}">${disptab.Caption}</li>
      #elseif ($disptab == $tab)
        <li class="element current">${disptab.Caption}</li>
      #elseif ($wizard.displayTab($disptab))
        <li class="element link" onclick="${wizard.getTabAction($disptab,$index)}">${disptab.Caption}</li>
      #end
    #end
        <li class="last">&nbsp;</li>
      </ul>
      <div class="right"></div>
    </div>
    #if ($wizardstate.isEmptyContent())
      <div id="contents" class="content_empty"> ## if last displayed form is empty > class="content_empty" 
    #else
      <div id="contents">
    #end 
    <div id="grid_block">
        #if ($tab.Header)
          <!-- HEADER -->
            ${wizard.includeJsp($tab.Header)}
          <!-- / HEADER -->
        #end
        #if ($wizard.sizeOfVisibleMenusAndSelect($tab) > 0)
          <!-- CONTEXT -->
          <div id="context">
            #if ($wizard.sizeOfVisibleMenus($tab) > 0)
              #foreach ($menu in $tab.MenuArray)
                #if ($wizard.displayMenu($menu))
                  <div class="grid_cell">
                    <div class="block008">
                      <p class="text010 ${menu.Icon}">${menu.Caption}</p>
                    </div>
                    <div class="block015">
                      <ul class="list001">
                        #foreach ($menuitem in $menu.MenuArray)
                          #if ($wizard.displayMenu($menuitem))
                            <li class="element"><a class="link" onclick="${wizard.menuAction($menuitem)}">${wizard.menuCaption($menuitem)}</a></li>
                          #end
                        #end
                      </ul>
                    </div>
                  </div>
                #end
              #end
            #end
            #if ($wizard.sizeOfVisibleSelect($tab) > 0)
              #set ($selectIndex = 0)
              #foreach ($select in $tab.SelectArray)
                #if ($wizard.displaySelect($select))
                #set ($selectIndex = $selectIndex + 1)
                  <div class="grid_cell">
                    <div class="block008">
                      <p class="text010 ${select.Icon}">${select.Title}</p>
                    </div>
  ##                 #if ($selectIndex == 1)
                    <div class="block015">
  ##                 #end
                      <ul class="${select.Style}">
                      #if (!$wizard.getItems($select))
                        #if ($select.Empty)
                          <li class="element empty">${select.Empty}</li>
                        #end
                      #else
                        #set ($index = 0)
                        #foreach ($item in $wizard.getItems($select))
                          <li class="element"><a class="link ${wizard.displayItemIcon($item)}" onclick="${wizard.onclickLink($select,$item,$index)}">${wizard.displayItem($item,$select.DisplayArray)}</a></li>
                          #set ($index = $index + 1)
                        #end
                      #end
                      #foreach ($menuitem in $select.MenuArray)
                          <li class="element"><a class="link" onclick="${wizard.menuAction($menuitem)}">${wizard.menuCaption($menuitem)}</a></li>
                      #end
                      </ul>
##                     #if ($selectIndex == $wizard.sizeOfVisibleSelect($tab))
                    </div>
  ##                   #end
                  </div>
                #end
              #end
            #end
          </div>
          <!-- / CONTEXT -->
          #if ($wizard.State)
            <!-- STATE -->
            #displayState($wizard $wizard.State)
            <!-- / STATE -->
          #end
  
        #elseif ($tab.sizeOfFormArray() > 0)
          #foreach ($form in $tab.FormArray)
            #if ($wizard.displayForm($form))
              <!-- FORM -->
                ${wizard.includeJsp($form)}
              <!-- / FORM -->
            #end
          #end

        #elseif($tab.isSetProcess())
          <!-- PROCESS -->
          #displayState($wizard $wizard.displayProcess($tab,$tab.Process))
          <!-- / PROCESS -->

        #elseif($wizard.State)
          <!-- STATE -->
          #displayState($wizard $wizard.State)
          <!-- / STATE -->
        #end

        #if ($tab.Footer)
          <!-- FOOTER -->
          ${wizard.includeJsp($tab.Footer)}
          <!-- / FOOTER -->
        #end
        <div class="clear-both"></div>
      </div>
    </div>
  </div>
 
#if ($wizardstate.getNavigate())
  <div id="menu">
    <ul>
    #foreach ($menu in $globalmenus.MenuArray)
      #if ($wizard.displayMenu($menu))
        <li class="menu">
          <span class="title ${menu.Icon}">${menu.Caption}</span>
          <ul>
          #foreach ($menuitem in $menu.MenuArray)
            #if ($wizard.displayMenu($menuitem))
              #if ($wizard.isSelected($menuitem))
                <li class="menuitem current" onclick="${wizard.menuAction($menuitem)}">${wizard.menuCaption($menuitem)}</li>
              #else
                <li class="menuitem" onclick="${wizard.menuAction($menuitem)}">${wizard.menuCaption($menuitem)}</li>
              #end
            #end
          #end
          </ul>
        </li>
      #end
    #end
    </ul>
  </div>
#end
  <div class="clear-both"></div>
</div>
#if ($wizardstate.Popup)
<div class="popup" id="popup_error">
  ${wizard.popup()}
  <a class="close_popup" onclick="HideBlock('popup_error');">Fermer</a>
</div>
#end
#if ($wizardstate.Alert)
<script>
  alert("${wizardstate.Alert}");
</script>
#end
<div id="copyright"><a href="http://www.cg95.fr">CapDémat &copy; 2004, ${year} Conseil Général du Val d'Oise</a> - ${wizard.Version}</div>

#if ($wizardstate.PdfFile)
<iframe src="${wizardstate.resetPdfFile()}" height=\"0\" ></iframe>
#end

#if ($global.sizeOfInitscriptArray() > 0)
<script type="text/javascript">
  #foreach ($script in $global.InitscriptArray)
    ${script};
  #end
</script>
#end

</body>
</html>
