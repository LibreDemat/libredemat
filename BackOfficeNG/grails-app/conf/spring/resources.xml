<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

  <import resource="applicationContext.xml"/>
  <!--
  <bean id="configurer"
    class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location">
      <value>BackOfficeNG-config.properties</value>
    </property>
  </bean>
  -->
  <bean id="abstractSessionFactory" abstract="true">

    <property name="mappingResources">
      <list>
        <value>fr/cg95/cvq/business/request/Request.hbm.xml</value>
        <value>fr/cg95/cvq/business/request/RequestType.hbm.xml</value>
        <value>fr/cg95/cvq/business/authority/LocalAuthority.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/HomeFolder.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/Individual.hbm.xml</value>
        <value>fr/cg95/cvq/business/document/Document.hbm.xml</value>
        <value>fr/cg95/cvq/business/document/DocumentBinary.hbm.xml</value>
        <value>fr/cg95/cvq/business/document/DocumentType.hbm.xml</value>
        <value>fr/cg95/cvq/business/school/OtherIndividual.hbm.xml</value>
        <value>fr/cg95/cvq/business/authority/School.hbm.xml</value>
        <value>fr/cg95/cvq/business/school/VacationsDiary.hbm.xml</value>
        <value>fr/cg95/cvq/business/authority/RecreationCenter.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/Address.hbm.xml</value>
        <value>fr/cg95/cvq/business/authority/Agent.hbm.xml</value>
        <value>fr/cg95/cvq/business/authority/Category.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/Card.hbm.xml</value>
        <value>fr/cg95/cvq/business/document/DocumentAction.hbm.xml</value>
        <value>fr/cg95/cvq/business/request/RequestAction.hbm.xml</value>
        <value>fr/cg95/cvq/business/request/RequestNote.hbm.xml</value>
        <value>fr/cg95/cvq/business/request/RequestForm.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/HistoryEntry.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/ChildLegalResponsible.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/LocalReferentialData.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/PlaceReservationData.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/TicketTypeSelection.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/payment/Payment.hbm.xml</value>
        <value>fr/cg95/cvq/business/users/payment/PurchaseItem.hbm.xml</value>
        <value>fr/cg95/cvq/business/social/DhrPreviousDwelling.hbm.xml</value>
        <value>fr/cg95/cvq/business/social/DhrDonation.hbm.xml</value>
        <value>fr/cg95/cvq/business/social/DhrPersonalEstateAndSaving.hbm.xml</value>
        <value>fr/cg95/cvq/business/social/DhrRealAsset.hbm.xml</value>
        <value>fr/cg95/cvq/business/request/MeansOfContact.hbm.xml</value>
      </list>
    </property>

    <property name="hibernateProperties">
      <props>
        <prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
        <prop key="hibernate.show_sql">false</prop>
        <prop key="hibernate.cglib.use_reflection_optimizer">true</prop>
        <prop key="hibernate.use_outer_join">false</prop>
        <!--
        <prop key="hibernate.cache.provider_class">org.hibernate.connection.C3P0ConnectionProvider</prop>
        -->
        <prop key="hibernate.cache.use_query_cache">false</prop>
      </props>
    </property>

    <property name="entityInterceptor">
      <ref bean="historyInterceptor" />
    </property>

  </bean>

  <bean id="ldapService" class="fr.cg95.cvq.service.authority.impl.LdapService"
    init-method="init">
    <property name="enabled">
      <value>${ldap.enabled}</value>
    </property>
    <property name="host">
      <value>${ldap.host}</value>
    </property>
    <property name="port">
      <value>${ldap.port}</value>
    </property>
    <property name="securityPrincipal">
      <value>${ldap.security_principal}</value>
    </property>
    <property name="securityCredentials">
      <value>${ldap.security_credentials}</value>
    </property>
    <property name="securityAuthentication">
      <value>${ldap.security_authentication}</value>
    </property>
    <property name="ditRoot">
      <value>${ldap.dit_root}</value>
    </property>
    <property name="peopleBranch">
      <value>${ldap.people_branch}</value>
    </property>
    <property name="peopleLastName">
      <value>${ldap.people.last_name_attribute}</value>
    </property>
    <property name="peopleFirstName">
      <value>${ldap.people.first_name_attribute}</value>
    </property>
    <property name="schoolBranch">
      <value>${ldap.school_branch}</value>
    </property>
    <property name="recreationCenterBranch">
      <value>${ldap.recreation_center_branch}</value>
    </property>
    <property name="localAuthorityDAO">
      <ref bean="localAuthorityDAO" />
    </property>
    <property name="schoolDAO">
      <ref bean="schoolDAO" />
    </property>
    <property name="recreationCenterDAO">
      <ref bean="recreationCenterDAO" />
    </property>
    <property name="localAuthorityRegistry">
      <ref bean="localAuthorityRegistry" />
    </property>
  </bean>

  <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <!-- the SMTP host responsible for sending mail messages -->
    <property name="host">
      <value>${mail.sender_host}</value>
    </property>
  </bean>

  <bean id="localAuthorityRegistry"
    class="fr.cg95.cvq.service.authority.impl.LocalAuthorityRegistry" init-method="init">
    <property name="localAuthorityDAO" ref="localAuthorityDAO" />
    <property name="performDbUpdates" value="true" />
    <property name="referentialBase" value="${referential.properties.path}" />
    <property name="assetsBase" value="${assets.properties.path}" />
    <property name="includes" value="${assets.included_authorities}" />
    <property name="localAuthoritiesListFilename" value="local_authorities_list.txt" />
  </bean>
  
  <!-- ================================================================ -->
  <!-- ========= Local Authorities Refresh Job Configuration =========  -->
  <!-- ================================================================ -->
<!--
  <bean id="localAuthoritiesRefreshJob"
    class="fr.cg95.cvq.service.authority.job.LocalAuthoritiesRefreshJob">
    <property name="localAuthoritiesLoader"><ref bean="localAuthoritiesLoader"/></property>
  </bean>

  <bean id="localAuthoritiesRefreshJobInvoker"
    class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
    <property name="targetObject" ref="localAuthoritiesRefreshJob" />
    <property name="targetMethod" value="launchJob" />
    <property name="concurrent" value="false" />
  </bean>
-->
  <!-- testing purposes only -->
  <!-- 
  <bean id="localAuthoritiesRefreshTrigger" 
    class="org.springframework.scheduling.quartz.SimpleTriggerBean">
    <property name="jobDetail" ref="paymentInitializationCheckerJobInvoker"/>
    <property name="startDelay" value="5000"/>
    <property name="repeatInterval" value="150000"/>
  </bean>
  -->
  <!-- production settings -->
<!--
  <bean id="localAuthoritiesRefreshJobTrigger"
    class="org.springframework.scheduling.quartz.CronTriggerBean">
    <property name="jobDetail" ref="localAuthoritiesRefreshJobInvoker" />
    <property name="cronExpression" value="0 * * * * ?" />
  </bean>
-->
  
  <!-- =============== Where everything happens (or not) ============== -->
  <!-- 
  <bean class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
    <property name="triggers">
      <list>
        <ref bean="localAuthoritiesRefreshJobTrigger" />
      </list>
    </property>
  </bean>
  -->
  
  <!-- ================================================================ -->
  <!-- ================== FAKE SERVICES DEFINITION ==================== -->
  <!-- ================================================================ -->

  <bean id="fakePaymentProviderService" 
    class="fr.cg95.cvq.payment.impl.FakePaymentProviderService">
    <property name="paymentUrl" value="${fake_payment.url}" />  
  </bean>

  <bean id="fakeExternalService" class="fr.cg95.cvq.external.impl.FakeExternalService">
    <property name="label" value="Horanet" />
    <property name="authorizingRequestLabel" value="VO Card Request" />
    <property name="requestServiceRegistry">
      <ref bean="requestServiceRegistry" />
    </property>
    <property name="homeFolderService">
      <ref bean="homeFolderService" />
    </property>
    <property name="xmlDirectory" value="external_service"/>
    <property name="consumptionsFile" value="consumptions.xml"/>
    <property name="accountsFile" value="accounts.xml"/>
    <property name="depositAccountDetailsFile" value="depositAccountDetails.xml" />
    <property name="invoiceDetailsFile" value="invoiceDetails.xml" />
    <property name="testDataDirectory" value="${data.properties.path}"/>
  </bean>
    
</beans>
