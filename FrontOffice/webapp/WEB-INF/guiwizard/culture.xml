<?xml version="1.0" encoding="UTF-8" ?>

<cvqprocess xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	 xsi:noNamespaceSchemaLocation="processes.xsd" >

  <processes group="culture" caption="Culturel" order="4">
	<!--****************** PROCESSUS INSCRIPTION A LA BIBLIOTHEQUE *******************-->
	<process name="eLibrary" caption="Bibliothèque" time="5">
		<title>Inscription à la bibliothèque</title>
		<confirm name="familyHome" check="hasOpenSeasons">L'inscription pour la saison est fermée.</confirm>
		<confirm name="familyHome" check="hasAuthorizedSubjects">Vous n'avez aucune personne à inscrire.</confirm>
		<package>fr.cg95.cvq.fo.cultural.library</package>
        <persistence>fr.cg95.cvq.fo.cultural.LibraryRegistrationPersistence</persistence>
		<information label="Règlement intérieur de la bibliothèque.">txt/ReglementLibrary.txt</information>

	    <!-- ******************* DEMANDEUR *********************-->
		<stage ref="Requester" />
		
		<stage name="Abonnee" caption="Personne à inscrire">
			<title>Personne à inscrire</title>
			<info>Sélection de la personne à inscrire et choix des options proposées</info>
			
			<confirm name="cancel">Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>
			<confirm name="delete">Voulez-vous vraiment supprimer les informations sur la qualité du demandeur?</confirm>
			<confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>
			<confirm name="continue" check="">Vous devez sélectionner une personne et enregistrer la page avant de passer à l'étape suivante</confirm>

			<default>default</default>

			<next confirm="continue"/>
			
			<state name="default" buttonArea="nonavigation" mode="static">
				<title>Personne à inscrire</title>
				<form>/cultural/library/abonnee/default</form>
			</state>
			
			<state name="abonnee">
				<title>Personne à inscrire</title>
				<form>/cultural/library/abonnee/abonnee</form>
				<button confirm="cancel" action="resetProcess" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="" transition="display">Enregistrer</button>
			</state>

			<state name="display" mode="static">
				<title>Personne à inscrire</title>
				<form>/cultural/library/abonnee/display</form>
				<button confirm="delete" action="resetProcess" transition="default">Supprimer</button>
				<button transition="abonnee" action="">Modifier</button>
			</state>

			<select name="familyHome" property="selectionListWithoutCurrent" state="default">
				<title>Personne(s) du compte</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action confirm="changed" parameter="index" transition="abonnee">createRequest</action> 
			</select>		

			<select name="familyHome" property="individualToRegister" state="all">
				<title>Personne à inscrire</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action parameter="index" transition="display">processStage</action> 
			</select>
		</stage>
		
		<stage ref="Documents"/>
		
		<!-- ******************* REGLEMENTAIRE *********************-->
		<stage name="Rules" caption="Règlementaire" stagemenu="display">
			<title>Règlementaire</title>
			<info>Informations sur le règlement du service concerné</info>
			<default>default</default>

			<next script="processSubmit" action=""/>
			
			<state name="default">
				<title>Règlementaire</title>
				<form>/common/rules/rules</form>
				<form>/cultural/library/rules/authorisation</form>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
		</stage>	
		
		<!-- ******************* VALIDATION *********************-->	
		<stage name="Validation" caption="Validation" stagemenu="display">
			<title>Validation et fin</title>
			<info>Résumé des informations fournies. A valider pour la création de votre demande</info>
		  
			<default>summary</default>

			<next>false</next>
			
			<state name="summary" mode="static">
				<form>/common/validation/requester</form>
				<form>/cultural/library/validation/summary</form>
				<form>/common/validation/documents</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="next" default="true" script="processSubmit" action="" transition="validation">Page suivante</button>
			</state>

			<state name="validation">
				<form>/common/validation/validation</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="trace">
				<form>/common/validation/trace</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="print" buttonArea="none" mode="noreturn">
				<form>/common/validation/print</form>
			</state>

		</stage>
	</process>

	<!--****************** PROCESSUS DE BILLETERIE *******************-->
	<process name="eReservation" caption="Billetterie" time="5">
		<title>Réservation de places</title>
		<script src="./js/AsyncManager.js"/>
		<script src="./js/reservation.js"/>
		<package>fr.cg95.cvq.fo.cultural.reservation</package>
        <persistence>fr.cg95.cvq.fo.cultural.PlaceReservationPersistence</persistence>

	    <!-- ******************* DEMANDEUR *********************-->

		<stage ref="Requester" />
	
	    <!-- ******************* ABONNEE *********************-->
		<stage name="Abonnee" caption="Numéro d'abonné" stagemenu="display" required="false">
			<title>Abonné</title>
			<info>Si vous êtes abonné, saisie du numéro d'abonné.</info>

			<!--  condition name="fr.cg95.cvq.fo.common.Request" property="!noRequester"/ -->
				
			<confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>

			<default>abonnee</default>

			<next script="processSubmit" action=""/>

			<state name="abonnee" mode="static">
				<form>/cultural/reservation/abonnee/explain</form>
				<form>/cultural/reservation/abonnee/abonnee</form>
				<button default="true" script="processSubmit" action="next">Page suivante</button>
			</state>
		</stage>

	    <!-- ******************* RESERVATION *********************-->
		<stage name="Places" caption="Places à réserver" stagemenu="display">
			<title>Places à réserver</title>
			<info>Sélection des spectacles et réservation des places.</info>

			<confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>
			<confirm name="continue" check="">Vous devez réserver des places avant de passer à l'étape suivante</confirm>

			<default>places</default>

			<next script="processSubmit" action=""/>
<!--
			<next confirm="continue"/>
-->		
			<state name="places">
				<title type="spectacle">A l'affiche</title>
				<form>/cultural/reservation/places/places</form>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
		</stage>

		<!-- ******************* VALIDATION *********************-->	
		<stage name="Validation" caption="Validation" stagemenu="display">
			<title>Validation et fin</title>
			<info>Résumé des informations fournies. A valider pour la création de votre demande</info>
		  
			<default>summary</default>

			<next>false</next>
			
			<state name="summary" mode="static">
				<form>/common/validation/requester</form>
				<form>/cultural/reservation/validation/summary</form>
				<form>/common/validation/documents</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="next" default="true" script="processSubmit" action="" transition="validation">Page suivante</button>
			</state>

			<state name="validation">
				<form>/common/validation/validation</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="trace">
				<form>/common/validation/trace</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="pay" buttonArea="none" mode="full">
				<form>/common/validation/pay</form>
			</state>

			<state name="payed" buttonArea="none" mode="noreturn">
				<form>/common/validation/print</form>
			</state>

			<state name="print" buttonArea="none" mode="noreturn">
				<form>/common/validation/print</form>
			</state>

		</stage>
	</process>
  </processes>		
</cvqprocess>
	