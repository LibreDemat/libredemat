<?xml version="1.0" encoding="UTF-8" ?>

<cvqprocess xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	 xsi:noNamespaceSchemaLocation="processes.xsd" >

  <processes group="election" caption="Election" order="5">
	<!-- ****** LISTE ELECTORALE ************-->
	<process name="eElection" caption="Listes électorales" time="5">
		<title>Listes électorales</title>
		<confirm name="familyHome" check="hasOpenSeasons">L'inscription sur les listes électorales est fermée.</confirm>
		<confirm name="familyHome" check="hasAuthorizedSubjects">Vous n'avez aucune personne à inscrire.</confirm>
		<package>fr.cg95.cvq.fo.election</package>
        <persistence>fr.cg95.cvq.fo.election.ElectoralRollPersistence</persistence>

	    <!-- ******************* LA PERSONNE A INSCRIRE *********************-->
		<stage name="Subject" caption="Personne à inscrire">
			<title>Personne à inscrire</title>
			<info>Renseignements sur la personne concernée par la demande</info>
			
			<confirm name="changed" check="state">Vos modifications éventuelles seront perdu ! Voulez-vous continuer ?</confirm>
			<confirm name="cancel">Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>
			<confirm name="delete">Voulez-vous vraiment supprimer les informations sur la personne à inscrire?</confirm>
			<confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>
			<confirm name="continue" check="">Vous devez sélectionner une personne et enregistrer la page avant de passer à l'étape suivante</confirm>

			<default>default</default>

			<previous confirm="terminate">endProcess</previous>
			<next confirm="continue"/>
			
			<state name="default" buttonArea="nonavigation" mode="static">
				<title>La personne à inscrire</title>
				<form>/election/subject/default</form>
			</state>

			<state name="subject">
				<title>La personne à inscrire</title>
				<form>/election/subject/subject</form>
				<button confirm="cancel" action="resetProcess" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="" transition="display">Enregistrer</button>
			</state>

			<state name="display" mode="static">
				<title>La personne à inscrire</title>
				<form>/election/subject/display</form>
				<button confirm="delete" action="resetProcess" transition="default">Supprimer</button>
				<button transition="subject" action="">Modifier</button>
			</state>

			<select name="familyHome" property="selectionListWithoutCurrent" state="default" >
				<title>Adulte(s) du compte</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action confirm="changed" parameter="index" transition="subject">createRequest</action> 
			</select>		

			<select name="familyHome" property="individualToRegister" state="all">
				<title>Adulte à inscrire</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action parameter="index" transition="display">processStage</action> 
			</select>
		</stage>
		
	    <!-- ******************* LA RAISON DE LA DEMANDE *********************-->
		<stage name="Reason" caption="Raison de la demande" stagemenu="display" >
			<title>Raison de la demande</title>
			<info>Renseignements complémentaires</info>

			<confirm name="cancel">Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>

			<default>default</default>
			<next script="processSubmit" action=""/>
			
			<state name="default" mode="static">
				<title>Raison de la demande</title>
				<form>/election/reason/default</form>
			</state>
						
			<state name="reason" change="confirm">
				<title>Raison de la demande</title>
				<form>/election/reason/reason</form>
				<button confirm="cancel" action="" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
						
			<state name="contributor" change="confirm">
				<title>Raison de la demande</title>
				<form>/election/reason/contributor</form>
				<button confirm="cancel" action="" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
						
			<state name="reason" change="confirm">
				<title>Raison de la demande</title>
				<form>/election/reason/reason</form>
				<button confirm="cancel" action="" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
						
			<menu state="default">
				<title>Raison de la demande</title>
				<button transition="reason" action="motive=NewCityResident" >Domicilié</button>
				<button transition="contributor" action="motive=DirectCityContribution" >Contribuable direct</button>
				<button transition="reason" action="motive=CivilServantObligatoryResident" >Résidence obligatoire</button>
				<button transition="reason" action="motive=FutureAuthorizedCitizen" >Nouvel électeur</button>
			</menu>
		</stage>

		<stage ref="Documents"/>
		
		<!-- ******************* VALIDATION *********************-->	
		<stage name="Validation" caption="Validation" stagemenu="display">
			<title>Validation et fin</title>
			<info>Résumé des informations fournies. A valider pour la création de votre demande</info>
		  
			<default>summary</default>

			<next>false</next>
			
			<state name="summary" mode="static">
				<form>/common/validation/requester</form>
				<form>/election/validation/summary</form>
				<form condition="motive==NewCityResident">/election/validation/summaryreason</form>
				<form condition="motive==DirectCityContribution">/election/validation/summarycontributor</form>
				<form condition="motive==CivilServantObligatoryResident">/election/validation/summaryreason</form>
				<form condition="motive==FutureAuthorizedCitizen">/election/validation/summaryreason</form>
				<form>/common/validation/documents</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="next" default="true" script="processSubmit" action="" transition="validation">Page suivante</button>
			</state>

			<state name="validation">
				<form>/common/validation/validation</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="trace">
				<form>/common/validation/trace</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="print" buttonArea="none" mode="noreturn">
				<form>/common/validation/print</form>
			</state>

		</stage>

	</process>
  </processes>		
</cvqprocess>
	