<?xml version="1.0" encoding="UTF-8" ?>

<cvqmanager	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
			xsi:noNamespaceSchemaLocation="managers.xsd" >
  <globals>
	<session data="accountManager" type="fr.cg95.cvq.fo.common.AccountManager" />

<!-- the timeout defined here should reflect the timeout defined in the web.xml -->
	<timeout delay="60" href="closeSession.do" />
	<timeout cookie="TERMINAL" delay="10" href="closeSession.do" />

	<script src="./js/utils.js" />
	<script src="./js/validation.js" />
	<script src="./js/AsyncManager.js" />
	<initscript>checkButtonLabelLength()</initscript>
	<initscript>resizeManager()</initscript>
	<initscript>window.onresize=resizeManager</initscript>
  </globals>
  
  <managers>
	<manager name="personal">
		<title>Espace personnel</title>
		<tab caption="Accueil">
			<title>Bienvenue dans votre espace personnel</title>
			<condition name="familyHome" property="boundToRequest" />
			<form>/personal/welcome/welcome</form>
		</tab>
		<tab caption="Accueil">
			<title>Bienvenue dans votre espace personnel</title>
			<condition name="familyHome" property="!boundToRequest" />
			<block name="update" column="1">
				<title>Votre espace foyer</title>
				<form>/personal/welcome/update</form>
			</block>
			<block name="info" column="1">
				<title>Informations</title>
				<form>/personal/welcome/information</form>
			</block>
			<block name="password" column="2">
				<title>Changement de mot de passe</title>
				<condition parameter="changepassword" />
				<form>/personal/welcome/password</form>
			</block>
			<block name="requests" column="2">
				<title>Dernières demandes</title>
				<form>/personal/welcome/requests</form>
			</block>
			<block name="gestion" column="2">
				<title>Informations sur votre compte</title>
				<condition name="familyHome" property="accountData" />
				<form>/personal/family/familydata</form>
			</block>
		</tab>
		<tab caption="Les Personnes">
			<title>Les informations des personnes</title>
			<condition domain="site" property="individuals"/>
			<default>info</default>

			<state name="info">
				<title>Les Personnes</title>
				<form>/personal/family/infoFamily</form>
			</state>

			<state name="account">
				<title>Détail</title>
				<form>/personal/family/familydata</form>
			</state>

			<state name="adults">
				<title>Adulte</title>
				<form>/personal/family/familyadult</form>
			</state>
			
			<state name="children">
				<title>Enfant</title>
				<form>/personal/family/familychild</form>
			</state>
			
			<select name="familyHome" property="adults" >
				<title>Les adultes</title>
				<empty>Aucun adult saisi</empty>
				<display type="adult"/>
				<display name="firstName"/>
				<display name="lastName"/>
				<action transition="adults" parameter="index">personal_showAdultAction</action>
			</select>
			<select name="familyHome" property="children" >
				<title>Les enfants</title>
				<empty>Aucun enfant saisi</empty>
				<display type="child"/>
				<display name="firstName"/>
				<display name="lastName"/>
				<action transition="children" parameter="index">personal_showChildAction</action>
			</select>
		</tab>
		<tab caption="Mes Demandes">
			<title>Les demandes en cours</title>
			<condition domain="site" property="requests"/>
			<form>/personal/request/request</form>
		</tab>
		<tab caption="Mes Documents">
			<title>Les justificatis fournis</title>
			<condition domain="site" property="documents"/>
			<action>displayDocumentsAction.do</action>

			<default>info</default>

			<state name="info">
				<form>/personal/document/info</form>
			</state>

			<state name="document">
				<form>/personal/document/document</form>
			</state>

			<state name="displaypage" background="false">
				<form>/personal/document/displayPage</form>
			</state>

			<select name="familyHome" property="groupedDocuments" >
				<title>Justificatif(s)</title>
				<empty>Aucun</empty>
				<display type="document"/>
				<display name="type"/>
				<action transition="document" parameter="id">documentDisplayAction</action>
			</select>
		</tab>
		<tab caption="Les Services">
			<title>Services disponibles</title>
			<condition name="familyHome" property="!boundToRequest" />
			<condition domain="site" property="services"/>

			<action>displayServicesAction.do</action>

			<default>info</default>

			<state name="info">
				<title>Mes Services</title>
				<form>/personal/services/infoServices</form>
			</state>

			<state name="presentation">
				<title>Mes Services</title>
				<form>/personal/services/presentation</form>
			</state>
			
			<menu caption="Social" processes="social">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Scolaire" processes="children">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Etat Civil" processes="civil">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Election" processes="election">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Urbanisme" processes="urban">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Loisirs" processes="leisure">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Culturel" processes="culture">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
                        <menu caption="Environnement" processes="environment">
                                <condition name="accountManager" property="active($process)"/>
                		<action>startRequest.do?private&amp;name=$process</action>
                        </menu>
			<menu caption="Sécurité" processes="localpolice">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="S. technique" processes="technical">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
		</tab>

		<tab caption="Mes Pointages">
			<title>Les pointages à la cantine</title>
			<condition name="familyHome" property="!boundToRequest" />
			<condition domain="site" property="checklist"/>
			<default>info</default>

			<state name="info">
				<title>Mes Pointages</title>
				<form>/personal/services/infoCounts</form>
			</state>
			
			<state name="counts">
				<title>Mes relevés de pointage</title>
				<form>/personal/services/account/counts</form>
			</state>
			
			<select name="familyHome" property="children" >
				<title>Les enfants</title>
				<empty>Aucun enfant</empty>
				<display type="child"/>
				<display name="firstName"/>
				<display name="lastName"/>
				<action transition="counts" parameter="index">personal_showChildCountsAction</action>
			</select>
		</tab>

		<tab caption="Mes Comptes">
			<title>Types de compte</title>
			<condition name="familyHome" property="!boundToRequest" />
			<condition domain="site" property="caddy"/>
			<default>info</default>

			<state name="info">
				<title>Mes Comptes</title>
				<form>/personal/services/infoAccounts</form>
			</state>
			<state name="individuals" background="false">
				<title>Comptes</title>
				<form>/personal/services/account/groups</form>
			</state>
			<state name="tickets" background="false">
				<title>Comptes</title>
				<form>/personal/services/account/accounts</form>
			</state>
			<state name="accounts" background="false">
				<title>Comptes</title>
				<form>/personal/services/account/accounts</form>
			</state>
			<state name="invoices" background="false">
				<title>Factures</title>
				<form>/personal/services/account/accounts</form>
			</state>
			<state name="caddy" background="false">
				<title>Paiement</title>
				<form>/personal/services/account/caddy</form>
			</state>
			<state name="statement" background="false">
				<title>Relevé de comptes</title>
				<form>/personal/services/account/statement</form>
			</state>
			<state name="payment">
				<form>/personal/services/account/wynid</form>
			</state>
			
			<menu caption="Relevé de comptes" type="document">
				<menu caption="Consulter votre relevé">
					<action transition="statement">statement</action>
				</menu>
			</menu>	
			<menu caption="0 Paiements en attente : &lt;strong&gt;00,00 &amp;euro;&lt;/strong&gt;" type="money" display="force">
				<menu caption="Voir les paiements en attente" type="red">
					<condition name="familyHome" property="purchaseItems" />
					<action transition="caddy" />
				</menu>
			</menu>	
			<menu caption="Comptes">
			   <condition name="fr.cg95.cvq.fo.business.RequestManager" property="!exists(html/paiementmessage.html)" />
 	           <menu caption="Comptes individuels">
    	            <action transition="individuals">accounts</action>
        	    </menu> 
            	<menu caption="Comptes de dépot">
                	<action transition="accounts">accounts</action>
            	</menu> 
				<menu caption="Factures à payer">
					<action transition="invoices">accounts</action>
				</menu>
			</menu>
		</tab>
					
		<tab caption="AdeLine">
			<title>La gestion des comptes AdeLine</title>
			<condition domain="site" property="adeline"/>
			<form>/personal/services/infoAdeLine</form>
		</tab>			
	</manager>

	<manager name="public">
		<title>Espace public</title>
		<action>displayServicesAction.do</action>
		<style>assets/common/css/public.css</style>
		<tab caption="Services">
			<title>Services disponibles</title>

			<default>info</default>

			<state name="info">
				<title>Démarches en ligne</title>
				<form>/public/publicServices</form>
			</state>
			
			<menu caption="Etat Civil" processes="civil">
				<condition name="accountManager" property="public($process)"/>
				<action>startRequest.do?name=$process</action>
			</menu>
			<menu caption="Urbanisme" processes="urban">
				<condition name="accountManager" property="public($process)"/>
				<action>startRequest.do?name=$process</action>
			</menu>
			<menu caption="Culturel" processes="culture">
				<condition name="accountManager" property="public($process)"/>
				<action>startRequest.do?name=$process</action>
			</menu>
		</tab>
		<tab caption="AdeLine">
			<title>La gestion des comptes AdeLine</title>
			<condition domain="site" property="adeline"/>
			<form>/personal/services/infoAdeLine</form>
		</tab>			
	</manager>
	<manager name="backoffice">
		<title>Access depuis BackOffice</title>
		<tab caption="Services">
			<title>Services disponibles</title>
			<condition name="familyHome" property="!boundToRequest" />

			<state name="presentation">
				<title>Mes Services</title>
				<form>/personal/services/presentation</form>
			</state>
			
			<menu caption="Compte" processes="citizen">
				<condition name="accountManager" property="active(eFamily)"/>
				<action>startRequest.do?private&amp;name=eFamily</action>
			</menu>
			<menu caption="Social" processes="social">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Scolaire" processes="children">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Etat Civil" processes="civil">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Election" processes="election">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Urbanisme" processes="urban">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Loisirs" processes="leisure">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Culturel" processes="culture">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
			<menu caption="Environnement" processes="environment">
				<condition name="accountManager" property="active($process)"/>
				<action>startRequest.do?private&amp;name=$process</action>
			</menu>
           		<menu caption="Sécurité" processes="localpolice">
                		<condition name="accountManager" property="active($process)"/>
               			<action>startRequest.do?private&amp;name=$process</action>
		        </menu>
            		<menu caption="S. technique" processes="technical">
                		<condition name="accountManager" property="active($process)"/>
                		<action>startRequest.do?private&amp;name=$process</action>
           		 </menu>
		</tab>

	</manager>
  </managers>
</cvqmanager>

