<?xml version="1.0" encoding="UTF-8" ?>

<cvqprocess xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	 xsi:noNamespaceSchemaLocation="processes.xsd" >

  <processes group="leisure" caption="Loisir" order="6">
	<!--****************** PROCESSUS INSCRIPTION ECOLE DE MUSIQUE *******************-->
	<process name="eMusic" caption="Ecole de musique" time="5">
		<title>Ecole de musique</title>
		<confirm name="familyHome" check="hasOpenSeasons">L'inscription pour la saison est fermée.</confirm>
		<confirm name="familyHome" check="hasAuthorizedSubjects">Vous n'avez aucune personne à inscrire.</confirm>
		<script src="./js/AsyncManager.js"/>
		<script src="./js/reservation.js"/>
		<package>fr.cg95.cvq.fo.leisure.music</package>
        <persistence>fr.cg95.cvq.fo.leisure.MusicSchoolPersistence</persistence>
		<information label="Règlement intérieur de l'école de musique.">txt/ReglementMusic.txt</information>

		<stage name="Student" caption="Personne à inscrire">
			<title>Personne à inscrire</title>
			<info>Sélection de la personne à inscrire</info>
			
			<confirm name="continue" check="">Vous devez sélectionner une personne avant de passer à l'étape suivante</confirm>
			<confirm name="cancel">Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>
			<confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>

			<default>default</default>

			<next confirm="continue"/>
			
			<state name="default" buttonArea="nonavigation" mode="static">
				<title>Personne à inscrire</title>
				<form>/leisure/music/student/default</form>
			</state>
			
			<state name="student">
				<title>Personne à inscrire</title>
				<form>/leisure/music/student/student</form>
				<button confirm="cancel" action="resetProcess" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>

			<select name="familyHome" property="selectionListWithoutCurrent" state="default">
				<title>Personne(s) du compte</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action confirm="changed" parameter="index" transition="student">createRequest</action> 
			</select>		

			<select name="familyHome" property="individualToRegister" state="all">
				<title>Personne à inscrire</title>
				<display type="people"/>
				<display name="firstName"/>
				<display name="lastName"  initial="true"/>
				<action parameter="index" transition="student">processStage</action> 
			</select>
		</stage>
		
		<stage name="Activities" caption="Activités" stagemenu="display">
			<title>Activités</title>
			<info>Choix des options proposées</info>

			<confirm name="continue" check="">Vous devez sélectionner une activité avant de passer à l'étape suivante</confirm>
			<confirm name="cancel">Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>
			<confirm name="delete">Voulez-vous vraiment supprimer votre choix d'activités ?</confirm>

			<default>activity</default>

			<next confirm="continue"/>
			
			<state name="activity">
				<title type="document">Activités</title>
				<form>/leisure/music/activities/activities</form>
				<button confirm="cancel" action="" transition="default">Annuler Saisie</button>
				<button default="true" script="processSubmit" action="" transition="display">Enregistrer</button>
			</state>

			<state name="display" mode="static">
				<title type="document">Activités</title>
				<form>/leisure/music/activities/display</form>
				<button transition="activity" action="">Modifier</button>
			</state>

			<select name="Activity" state="all">
				<title>Activité séléctionné</title>
				<display type="document"/>
				<action transition="activity">processStage</action> 
			</select>
		</stage>

		<stage ref="Documents"/>
		
		<!-- ******************* REGLEMENTAIRE *********************-->
		<stage name="Rules" caption="Règlementaire" stagemenu="display">
			<title>Règlementaire</title>
			<info>Informations sur le règlement du service concerné</info>
			<default>default</default>

			<next script="processSubmit" action=""/>
			
			<state name="default">
				<title>Règlementaire</title>
				<form>/common/rules/rules</form>
				<form>/leisure/music/rules/authorisation</form>
				<button type="cancel" action="" >Annuler Saisie</button>
				<button default="true" script="processSubmit" action="next">Enregistrer</button>
			</state>
		</stage>	
		
		<!-- ******************* VALIDATION *********************-->	
		<stage name="Validation" caption="Validation" stagemenu="display">
			<title>Validation et fin</title>
			<info>Résumé des informations fournies. A valider pour la création de votre demande</info>
		  
			<default>summary</default>

			<next>false</next>
			
			<state name="summary" mode="static">
				<form>/common/validation/requester</form>
				<form>/leisure/music/validation/summary</form>
				<form>/common/validation/documents</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="next" default="true" script="processSubmit" action="" transition="validation">Page suivante</button>
			</state>

			<state name="validation">
				<form>/common/validation/validation</form>
				<button type="quit" script="cancelRequest()">Annuler la demande</button>
				<button type="save" script="validateRequest()">Enregistrer</button>
			</state>

			<state name="print" buttonArea="none" mode="noreturn">
				<form>/common/validation/print</form>
			</state>
		</stage>

    </process>

    <!-- SMS NOTIFICATION : WEBFLOW DESCRIPTION -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <process name="eSms" caption="Infolettre SMS" time="5">
      <title>Infolettre Sms</title>
      <confirm name="familyHome" check="hasAuthorizedSubjects">Vous n'avez aucune personne à inscrire.</confirm>
      <package>fr.cg95.cvq.fo.leisure.sms</package>
      <persistence>fr.cg95.cvq.fo.leisure.SmsNotificationPersistence</persistence>

      <!-- REQUESTER -->
      <!--  <stage ref="Requester" /> -->

      <!-- SUBSCRIBER -->
      <stage name="Subscriber" caption="Personne à inscrire" stagemenu="display"> 
        <title>Personne à inscrire</title>
        <info>Sélection de la personne</info>
        <confirm name="cancel"> Attention ! Les données de la demande n'ont pas été enregistrées ! Voulez-vous quand même annuler la saisie ?</confirm>
        <confirm name="delete">Voulez-vous vraiment supprimer les informations sur la personne à inscrire ?</confirm>
        <confirm name="terminate">Voulez-vous vraiment abandonner ?</confirm>
        <confirm name="continue" check="">Vous devez sélectionner une personne et enregistrer la page avant de passer à l'étape suivante</confirm>
        <default>default</default>
        <previous confirm="terminate">endProcess</previous>
        <next confirm="continue" />
        
        <state name="default">
          <title>Personne à inscrire</title>
          <form>/leisure/sms/subscriber/default</form>
        </state>
        
        <state name="subscriber">
          <title>Personne à inscrire</title>
          <form>/leisure/sms/subscriber/subscriber</form>
          <button confirm="cancel" action="resetProcess" transition="default">Annuler Saisie</button>
          <button transition="display" default="true" script="processSubmit" action="">Enregistrer</button>
        </state>
        
        <state name="display" mode="static">
          <title>Personne à inscrire</title>
          <form>/leisure/sms/subscriber/display</form>
          <button confirm="delete" action="resetProcess" transition="default">Supprimer</button>
          <button transition="subscriber" action="">Modifier</button>
        </state>
        
        <select name="familyHome" property="selectionListWithoutCurrent" state="default">
          <title>Adulte(s) non-inscrits</title>
          <display type="people" />
          <display name="firstName" />
          <display name="lastName" initial="true" />
          <action confirm="changed" parameter="index" transition="subscriber">createRequest</action>
        </select>
      
        <select name="familyHome" property="individualToRegister" state="all">
          <title>Adulte à inscrire</title>
          <display type="people" />
          <display name="firstName" />
          <display name="lastName" initial="true" />
          <action parameter="index" transition="display">processStage</action>
        </select>

      </stage>

      <stage ref="Documents" />

      <!-- SUBSCRIPTION -->
      <stage name="Subscription" caption="Inscription / Désinscription" stagemenu="display">
        <title>Inscription / Désinscription</title>
        <info>Gérez votre inscription à l'infolettre Sms</info>
        <default>subscription</default>
        <next script="processSubmit" action="" />
        
        <state name="subscription">
          <title>Inscription / Désinscription</title>
          <form>/leisure/sms/subscription/subscription</form>
          <button confirm="cancel" action="resetProcess" transition="default">Annuler Saisie</button>
          <button transition="display" default="true" script="processSubmit" action="">Enregistrer</button>
        </state>
        
        <state name="display" mode="static">
          <title>Inscription / Désinscription</title>
          <form>/leisure/sms/subscription/display</form>
          <button confirm="delete" action="resetProcess" transition="default">Supprimer</button>
          <button transition="subscription" action="">Modifier</button>
        </state>
      </stage>

      <!-- VALIDATION -->
      <stage name="Validation" caption="Validation" stagemenu="display">
        <title>Validation et fin</title>
        <info>Résumé des informations fournies. A valider pour la création de votre demande</info>
        <default>summary</default>
        <next>false</next>
        
        <state name="summary" mode="static">
          <form>/common/validation/requester</form>
          <form>/leisure/sms/validation/summary</form>
          <form>/common/validation/documents</form>
          <button type="quit" script="cancelRequest()">Annuler la demande</button>
          <button type="next" default="true" script="processSubmit" action="" transition="validation">Page suivante</button>
        </state>
        
        <state name="validation">
          <form>/common/validation/validation</form>
          <button type="quit" script="cancelRequest()">Annuler la demande</button>
          <button type="save" script="validateRequest()">Enregistrer</button>
        </state>
        
        <state name="trace">
          <form>/common/validation/trace</form>
          <button type="quit" script="cancelRequest()">Annuler la demande</button>
          <button type="save" script="validateRequest()">Enregistrer</button>
        </state>
        
        <state name="print" buttonArea="none" mode="noreturn">
          <form>/common/validation/print</form>
        </state>
      </stage>

    </process>

  </processes>		
</cvqprocess>

